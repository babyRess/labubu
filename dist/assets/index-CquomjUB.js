var e,t,n,i,s,a,o,l,r,h,c,u,d,p,m,f,g,b,y,w,S,v,k,_,x,B,M,A,C,T,P,R,L,W,E,I,$,F,G,O,D,V,z,N,H,U,j,q,K,X,Y,J,Q,Z,ee,te,ne,ie,se,ae,oe,le,re=Object.defineProperty,he=e=>{throw TypeError(e)},ce=(e,t,n)=>((e,t,n)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),ue=(e,t,n)=>t.has(e)||he("Cannot "+n),de=(e,t,n)=>(ue(e,t,"read from private field"),n?n.call(e):t.get(e)),pe=(e,t,n)=>t.has(e)?he("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),me=(e,t,n,i)=>(ue(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),fe=(e,t,n)=>(ue(e,t,"access private method"),n);import{s as ge,A as be,T as ye,H as we,I as Se,J as ve,u as ke,K as _e,M as xe,N as Be}from"./pixi-BIzyt2fv.js";import{S as Me}from"./spine-N1NWo_nv.js";import{h as Ae}from"./howler-CoAwPpvK.js";import{g as Ce}from"./gsap-CL1SgVcg.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();"undefined"!=typeof window&&((e=window.__svelte??(window.__svelte={})).v??(e.v=new Set)).add("5");let Te=!1;Te=!0;const Pe=Symbol(),Re=!1;var Le=Array.isArray,We=Array.prototype.indexOf,Ee=Array.from,Ie=Object.defineProperty,$e=Object.getOwnPropertyDescriptor,Fe=Object.getOwnPropertyDescriptors,Ge=Object.prototype,Oe=Array.prototype,De=Object.getPrototypeOf,Ve=Object.isExtensible;const ze=()=>{};function Ne(e){return e()}function He(e){for(var t=0;t<e.length;t++)e[t]()}function Ue(){var e,t;return{promise:new Promise((n,i)=>{e=n,t=i}),resolve:e,reject:t}}const je=16,qe=32,Ke=64,Xe=128,Ye=512,Je=1024,Qe=2048,Ze=4096,et=8192,tt=16384,nt=32768,it=65536,st=1<<17,at=1<<18,ot=1<<19,lt=32768,rt=1<<21,ht=1<<23,ct=Symbol("$state"),ut=new class extends Error{constructor(){super(...arguments),ce(this,"name","StaleReactionError"),ce(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function dt(e){return e===this.v}function pt(e){return t=e,n=this.v,!(t!=t?n==n:t!==n||null!==t&&"object"==typeof t||"function"==typeof t);var t,n}let mt=null;function ft(e){mt=e}function gt(e,t=!1,n){mt={p:mt,i:!1,c:null,e:null,s:e,x:null,l:Te&&!t?{s:null,u:null,$:[]}:null}}function bt(e){var t=mt,n=t.e;if(null!==n)for(var i of(t.e=null,n))wn(i);return t.i=!0,mt=t.p,{}}function yt(){return!Te||null!==mt&&null===mt.l}let wt=[];function St(e){if(0===wt.length){var t=wt;queueMicrotask(()=>{t===wt&&function(){var e=wt;wt=[],He(e)}()})}wt.push(e)}function vt(e){var t=Dn;if(null===t)return Fn.f|=ht,e;if(0===(t.f&nt)){if(0===(t.f&Xe))throw e;t.b.error(e)}else kt(e,t)}function kt(e,t){for(;null!==t;){if(0!==(t.f&Xe))try{return void t.b.error(e)}catch(n){e=n}t=t.parent}throw e}const _t=new Set;let xt=null,Bt=null,Mt=[],At=null,Ct=!1;t=new WeakMap,n=new WeakMap,i=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakMap,r=new WeakSet,h=function(e,t){e.f^=Je;for(var n=e.first;null!==n;){var i=n.f,s=!!(96&i),a=s&&0!==(i&Je)||0!==(i&et)||this.skipped_effects.has(n);if(0!==(n.f&Xe)&&n.b?.is_pending()&&(t={parent:t,effect:n,effects:[],render_effects:[],block_effects:[]}),!a&&null!==n.fn){s?n.f^=Je:4&i?t.effects.push(n):Qn(n)&&(0!==(n.f&je)&&t.block_effects.push(n),ii(n));var o=n.first;if(null!==o){n=o;continue}}var l=n.parent;for(n=n.next;null===n&&null!==l;)l===t.effect&&(fe(this,r,c).call(this,t.effects),fe(this,r,c).call(this,t.render_effects),fe(this,r,c).call(this,t.block_effects),t=t.parent),n=l.next,l=l.parent}},c=function(e){for(const t of e){(0!==(t.f&Qe)?de(this,o):de(this,l)).push(t),fe(this,r,u).call(this,t.deps),hi(t,Je)}},u=function(e){if(null!==e)for(const t of e)2&t.f&&0!==(t.f&lt)&&(t.f^=lt,fe(this,r,u).call(this,t.deps))},d=function(){if(0===de(this,s)){for(const e of de(this,t))e();de(this,t).clear()}0===de(this,i)&&fe(this,r,p).call(this)},p=function(){var e;if(_t.size>1){this.previous.clear();var t=Bt,n=!0,i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const t of _t){if(t===this){n=!1;continue}const a=[];for(const[e,i]of this.current){if(t.current.has(e)){if(!n||i===t.current.get(e))continue;t.current.set(e,i)}a.push(e)}if(0===a.length)continue;const o=[...t.current.keys()].filter(e=>!this.current.has(e));if(o.length>0){var s=Mt;Mt=[];const n=new Set,l=new Map;for(const e of a)Wt(e,o,n,l);if(Mt.length>0){xt=t,t.apply();for(const n of Mt)fe(e=t,r,h).call(e,n,i);t.deactivate()}Mt=s}}xt=null,Bt=t}this.committed=!0,_t.delete(this)};let Tt=class e{constructor(){pe(this,r),ce(this,"committed",!1),ce(this,"current",new Map),ce(this,"previous",new Map),pe(this,t,new Set),pe(this,n,new Set),pe(this,i,0),pe(this,s,0),pe(this,a,null),pe(this,o,[]),pe(this,l,[]),ce(this,"skipped_effects",new Set),ce(this,"is_fork",!1)}is_deferred(){return this.is_fork||de(this,s)>0}process(e){Mt=[],this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const n of e)fe(this,r,h).call(this,n,t);this.is_fork||fe(this,r,d).call(this),this.is_deferred()?(fe(this,r,c).call(this,t.effects),fe(this,r,c).call(this,t.render_effects),fe(this,r,c).call(this,t.block_effects)):(xt=null,Lt(t.render_effects),Lt(t.effects),de(this,a)?.resolve()),Bt=null}capture(e,t){this.previous.has(e)||this.previous.set(e,t),0===(e.f&ht)&&(this.current.set(e,e.v),Bt?.set(e,e.v))}activate(){xt=this,this.apply()}deactivate(){xt===this&&(xt=null,Bt=null)}flush(){if(this.activate(),Mt.length>0){if(function(){var e=Wn;Ct=!0;try{var t=0;for(En(!0);Mt.length>0;){var n=Tt.ensure();if(t++>1e3)Re,Pt();n.process(Mt),qt.clear()}}finally{Ct=!1,En(e),At=null}}(),null!==xt&&xt!==this)return}else 0===de(this,i)&&this.process([]);this.deactivate()}discard(){for(const e of de(this,n))e(this);de(this,n).clear()}increment(e){me(this,i,de(this,i)+1),e&&me(this,s,de(this,s)+1)}decrement(e){me(this,i,de(this,i)-1),e&&me(this,s,de(this,s)-1),this.revive()}revive(){for(const e of de(this,o))hi(e,Qe),It(e);for(const e of de(this,l))hi(e,Ze),It(e);me(this,o,[]),me(this,l,[]),this.flush()}oncommit(e){de(this,t).add(e)}ondiscard(e){de(this,n).add(e)}settled(){return(de(this,a)??me(this,a,Ue())).promise}static ensure(){if(null===xt){const t=xt=new e;_t.add(xt),e.enqueue(()=>{xt===t&&t.flush()})}return xt}static enqueue(e){St(e)}apply(){}};function Pt(){try{!function(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}()}catch(e){kt(e,At)}}let Rt=null;function Lt(e){var t=e.length;if(0!==t){for(var n=0;n<t;){var i=e[n++];if(!(24576&i.f)&&Qn(i)&&(Rt=new Set,ii(i),null===i.deps&&null===i.first&&null===i.nodes_start&&(null===i.teardown&&null===i.ac?An(i):i.fn=null),Rt?.size>0)){qt.clear();for(const e of Rt){if(24576&e.f)continue;const t=[e];let n=e.parent;for(;null!==n;)Rt.has(n)&&(Rt.delete(n),t.push(n)),n=n.parent;for(let e=t.length-1;e>=0;e--){const n=t[e];24576&n.f||ii(n)}}Rt.clear()}}Rt=null}}function Wt(e,t,n,i){if(!n.has(e)&&(n.add(e),null!==e.reactions))for(const s of e.reactions){const e=s.f;2&e?Wt(s,t,n,i):4194320&e&&0===(e&Qe)&&Et(s,t,i)&&(hi(s,Qe),It(s))}}function Et(e,t,n){const i=n.get(e);if(void 0!==i)return i;if(null!==e.deps)for(const s of e.deps){if(t.includes(s))return!0;if(2&s.f&&Et(s,t,n))return n.set(s,!0),!0}return n.set(e,!1),!1}function It(e){for(var t=At=e;null!==t.parent;){var n=(t=t.parent).f;if(Ct&&t===Dn&&0!==(n&je)&&0===(n&at))return;if(96&n){if(0===(n&Je))return;t.f^=Je}}Mt.push(t)}class $t{constructor(e,t,n){pe(this,P),ce(this,"parent"),pe(this,m,!1),pe(this,f),pe(this,g,null),pe(this,b),pe(this,y),pe(this,w),pe(this,S,null),pe(this,v,null),pe(this,k,null),pe(this,_,null),pe(this,x,null),pe(this,B,0),pe(this,M,0),pe(this,A,!1),pe(this,C,null),pe(this,T,function(e){let t,n=0,i=Xt(0);return()=>{bn()&&(si(i),vn(()=>(0===n&&(t=li(()=>e(()=>en(i)))),n+=1,()=>{St(()=>{n-=1,0===n&&(t?.(),t=void 0,en(i))})})))}}(()=>(me(this,C,Xt(de(this,B))),()=>{me(this,C,null)}))),me(this,f,e),me(this,b,t),me(this,y,n),this.parent=Dn.b,me(this,m,!!de(this,b).pending),me(this,w,kn(()=>{Dn.b=this;var e=fe(this,P,R).call(this);try{me(this,S,_n(()=>n(e)))}catch(t){this.error(t)}return de(this,M)>0?fe(this,P,W).call(this):me(this,m,!1),()=>{de(this,x)?.remove()}},589952))}is_pending(){return de(this,m)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!de(this,b).pending}update_pending_count(e){fe(this,P,E).call(this,e),me(this,B,de(this,B)+e),de(this,C)&&Zt(de(this,C),de(this,B))}get_effect_pending(){return de(this,T).call(this),si(de(this,C))}error(e){var t=de(this,b).onerror;let n=de(this,b).failed;if(de(this,A)||!t&&!n)throw e;de(this,S)&&(Mn(de(this,S)),me(this,S,null)),de(this,v)&&(Mn(de(this,v)),me(this,v,null)),de(this,k)&&(Mn(de(this,k)),me(this,k,null));var i=!1,s=!1;const a=()=>{i?console.warn("https://svelte.dev/e/svelte_boundary_reset_noop"):(i=!0,s&&function(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}(),Tt.ensure(),me(this,B,0),null!==de(this,k)&&Cn(de(this,k),()=>{me(this,k,null)}),me(this,m,this.has_pending_snippet()),me(this,S,fe(this,P,L).call(this,()=>(me(this,A,!1),_n(()=>de(this,y).call(this,de(this,f)))))),de(this,M)>0?fe(this,P,W).call(this):me(this,m,!1))};var o=Fn;try{On(null),s=!0,t?.(e,a),s=!1}catch(l){kt(l,de(this,w)&&de(this,w).parent)}finally{On(o)}n&&St(()=>{me(this,k,fe(this,P,L).call(this,()=>{Tt.ensure(),me(this,A,!0);try{return _n(()=>{n(de(this,f),()=>e,()=>a)})}catch(l){return kt(l,de(this,w).parent),null}finally{me(this,A,!1)}}))})}}function Ft(e,t,n,i){const s=yt()?Ot:zt;if(0!==n.length||0!==e.length){var a,o,l,r,h=xt,c=Dn,u=(a=Dn,o=Fn,l=mt,r=xt,function(e=!0){Vn(a),On(o),ft(l),e&&r?.activate()});e.length>0?Promise.all(e).then(()=>{u();try{return d()}finally{h?.deactivate(),Gt()}}):d()}else i(t.map(s));function d(){Promise.all(n.map(e=>Dt(e))).then(e=>{u();try{i([...t.map(s),...e])}catch(n){0===(c.f&tt)&&kt(n,c)}h?.deactivate(),Gt()}).catch(e=>{kt(e,c)})}}function Gt(){Vn(null),On(null),ft(null)}function Ot(e){var t=null!==Fn&&2&Fn.f?Fn:null;null!==Dn&&(Dn.f|=ot);return{ctx:mt,deps:null,effects:null,equals:dt,f:2050,fn:e,reactions:null,rv:0,v:Pe,wv:0,parent:t??Dn,ac:null}}function Dt(e,t){let n=Dn;null===n&&function(){throw new Error("https://svelte.dev/e/async_derived_orphan")}();var i=n.b,s=void 0,a=Xt(Pe),o=!Fn,l=new Map;return function(e){gn(4718592,e,!0)}(()=>{var t=Ue();s=t.promise;try{Promise.resolve(e()).then(t.resolve,t.reject).then(()=>{n===xt&&n.committed&&n.deactivate(),Gt()})}catch(c){t.reject(c),Gt()}var n=xt;if(o){var r=!i.is_pending();i.update_pending_count(1),n.increment(r),l.get(n)?.reject(ut),l.delete(n),l.set(n,t)}const h=(e,t=void 0)=>{if(n.activate(),t)t!==ut&&(a.f|=ht,Zt(a,t));else{0!==(a.f&ht)&&(a.f^=ht),Zt(a,e);for(const[e,t]of l){if(l.delete(e),e===n)break;t.reject(ut)}}o&&(i.update_pending_count(-1),n.decrement(r))};t.promise.then(h,e=>h(null,e||"unknown"))}),function(e){const t=gn(8,null,!1);hi(t,Je),t.teardown=e}(()=>{for(const e of l.values())e.reject(ut)}),new Promise(e=>{!function t(n){function i(){n===s?e(a):t(s)}n.then(i,i)}(s)})}function Vt(e){const t=Ot(e);return Nn(t),t}function zt(e){const t=Ot(e);return t.equals=pt,t}function Nt(e){var t=e.effects;if(null!==t){e.effects=null;for(var n=0;n<t.length;n+=1)Mn(t[n])}}function Ht(e){var t,n=Dn;Vn(function(e){for(var t=e.parent;null!==t;){if(!(2&t.f))return 0===(t.f&tt)?t:null;t=t.parent}return null}(e));try{e.f&=-32769,Nt(e),t=ei(e)}finally{Vn(n)}return t}function Ut(e){var t=Ht(e);(e.equals(t)||(xt?.is_fork||(e.v=t),e.wv=Jn()),In)||(null!==Bt?bn()&&Bt.set(e,t):hi(e,0===(e.f&Ye)?Ze:Je))}m=new WeakMap,f=new WeakMap,g=new WeakMap,b=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,v=new WeakMap,k=new WeakMap,_=new WeakMap,x=new WeakMap,B=new WeakMap,M=new WeakMap,A=new WeakMap,C=new WeakMap,T=new WeakMap,P=new WeakSet,R=function(){var e=de(this,f);return de(this,m)&&(me(this,x,rn()),de(this,f).before(de(this,x)),e=de(this,x)),e},L=function(e){var t=Dn,n=Fn,i=mt;Vn(de(this,w)),On(de(this,w)),ft(de(this,w).ctx);try{return e()}catch(s){return vt(s),null}finally{Vn(t),On(n),ft(i)}},W=function(){const e=de(this,b).pending;null!==de(this,S)&&(me(this,_,document.createDocumentFragment()),de(this,_).append(de(this,x)),Ln(de(this,S),de(this,_))),null===de(this,v)&&me(this,v,_n(()=>e(de(this,f))))},E=function(e){var t;this.has_pending_snippet()?(me(this,M,de(this,M)+e),0===de(this,M)&&(me(this,m,!1),de(this,v)&&Cn(de(this,v),()=>{me(this,v,null)}),de(this,_)&&(de(this,f).before(de(this,_)),me(this,_,null)))):this.parent&&fe(t=this.parent,P,E).call(t,e)};let jt=new Set;const qt=new Map;let Kt=!1;function Xt(e,t){return{f:0,v:e,reactions:null,equals:dt,rv:0,wv:0}}function Yt(e,t){const n=Xt(e);return Nn(n),n}function Jt(e,t=!1,n=!0){var i;const s=Xt(e);return t||(s.equals=pt),Te&&n&&null!==mt&&null!==mt.l&&((i=mt.l).s??(i.s=[])).push(s),s}function Qt(e,t,n=!1){return null!==Fn&&(!Gn||0!==(Fn.f&st))&&yt()&&4325394&Fn.f&&!zn?.includes(e)&&function(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}(),Zt(e,n?nn(t):t)}function Zt(e,t){if(!e.equals(t)){var n=e.v;In?qt.set(e,t):qt.set(e,n),e.v=t;var i=Tt.ensure();i.capture(e,n),2&e.f&&(0!==(e.f&Qe)&&Ht(e),hi(e,0!==(e.f&Ye)?Je:Ze)),e.wv=Jn(),tn(e,Qe),!yt()||null===Dn||0===(Dn.f&Je)||96&Dn.f||(null===jn?function(e){jn=e}([e]):jn.push(e)),!i.is_fork&&jt.size>0&&!Kt&&function(){Kt=!1;var e=Wn;En(!0);const t=Array.from(jt);try{for(const e of t)0!==(e.f&Je)&&hi(e,Ze),Qn(e)&&ii(e)}finally{En(e)}jt.clear()}()}return t}function en(e){Qt(e,e.v+1)}function tn(e,t){var n=e.reactions;if(null!==n)for(var i=yt(),s=n.length,a=0;a<s;a++){var o=n[a],l=o.f;if(i||o!==Dn){var r=0===(l&Qe);if(r&&hi(o,t),2&l){var h=o;Bt?.delete(h),0===(l&lt)&&(l&Ye&&(o.f|=lt),tn(h,Ze))}else r&&(0!==(l&je)&&null!==Rt&&Rt.add(o),It(o))}}}function nn(e){if("object"!=typeof e||null===e||ct in e)return e;const t=De(e);if(t!==Ge&&t!==Oe)return e;var n=new Map,i=Le(e),s=Yt(0),a=Xn,o=e=>{if(Xn===a)return e();var t=Fn,n=Xn;On(null),Yn(a);var i=e();return On(t),Yn(n),i};return i&&n.set("length",Yt(e.length)),new Proxy(e,{defineProperty(e,t,i){"value"in i&&!1!==i.configurable&&!1!==i.enumerable&&!1!==i.writable||function(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}();var s=n.get(t);return void 0===s?s=o(()=>{var e=Yt(i.value);return n.set(t,e),e}):Qt(s,i.value,!0),!0},deleteProperty(e,t){var i=n.get(t);if(void 0===i){if(t in e){const e=o(()=>Yt(Pe));n.set(t,e),en(s)}}else Qt(i,Pe),en(s);return!0},get(t,i,s){if(i===ct)return e;var a=n.get(i),l=i in t;if(void 0!==a||l&&!$e(t,i)?.writable||(a=o(()=>Yt(nn(l?t[i]:Pe))),n.set(i,a)),void 0!==a){var r=si(a);return r===Pe?void 0:r}return Reflect.get(t,i,s)},getOwnPropertyDescriptor(e,t){var i=Reflect.getOwnPropertyDescriptor(e,t);if(i&&"value"in i){var s=n.get(t);s&&(i.value=si(s))}else if(void 0===i){var a=n.get(t),o=a?.v;if(void 0!==a&&o!==Pe)return{enumerable:!0,configurable:!0,value:o,writable:!0}}return i},has(e,t){if(t===ct)return!0;var i=n.get(t),s=void 0!==i&&i.v!==Pe||Reflect.has(e,t);if((void 0!==i||null!==Dn&&(!s||$e(e,t)?.writable))&&(void 0===i&&(i=o(()=>Yt(s?nn(e[t]):Pe)),n.set(t,i)),si(i)===Pe))return!1;return s},set(e,t,a,l){var r=n.get(t),h=t in e;if(i&&"length"===t)for(var c=a;c<r.v;c+=1){var u=n.get(c+"");void 0!==u?Qt(u,Pe):c in e&&(u=o(()=>Yt(Pe)),n.set(c+"",u))}void 0===r?h&&!$e(e,t)?.writable||(Qt(r=o(()=>Yt(void 0)),nn(a)),n.set(t,r)):(h=r.v!==Pe,Qt(r,o(()=>nn(a))));var d=Reflect.getOwnPropertyDescriptor(e,t);if(d?.set&&d.set.call(l,a),!h){if(i&&"string"==typeof t){var p=n.get("length"),m=Number(t);Number.isInteger(m)&&m>=p.v&&Qt(p,m+1)}en(s)}return!0},ownKeys(e){si(s);var t=Reflect.ownKeys(e).filter(e=>{var t=n.get(e);return void 0===t||t.v!==Pe});for(var[i,a]of n)a.v===Pe||i in e||t.push(i);return t},setPrototypeOf(){!function(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}()}})}var sn,an,on,ln;function rn(e=""){return document.createTextNode(e)}function hn(e){return on.call(e)}function cn(e){return ln.call(e)}function un(e,t){return hn(e)}function dn(e,t=!1){var n=hn(e);return n instanceof Comment&&""===n.data?cn(n):n}function pn(e,t=1,n=!1){let i=e;for(;t--;)i=cn(i);return i}function mn(e){var t=Fn,n=Dn;On(null),Vn(null);try{return e()}finally{On(t),Vn(n)}}function fn(e){null===Dn&&(null===Fn&&function(){throw new Error("https://svelte.dev/e/effect_orphan")}(),function(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}()),In&&function(){throw new Error("https://svelte.dev/e/effect_in_teardown")}()}function gn(e,t,n){var i=Dn;null!==i&&0!==(i.f&et)&&(e|=et);var s={ctx:mt,deps:null,nodes_start:null,nodes_end:null,f:e|Qe|Ye,first:null,fn:t,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{ii(s),s.f|=nt}catch(l){throw Mn(s),l}else null!==t&&It(s);var a=s;if(n&&null===a.deps&&null===a.teardown&&null===a.nodes_start&&a.first===a.last&&0===(a.f&ot)&&(a=a.first,0!==(e&je)&&0!==(e&it)&&null!==a&&(a.f|=it)),null!==a&&(a.parent=i,null!==i&&function(e,t){var n=t.last;null===n?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}(a,i),null!==Fn&&2&Fn.f&&0===(e&Ke))){var o=Fn;(o.effects??(o.effects=[])).push(a)}return s}function bn(){return null!==Fn&&!Gn}function yn(e){fn();var t=Dn.f;if(!(!Fn&&0!==(t&qe)&&0===(t&nt)))return wn(e);var n=mt;(n.e??(n.e=[])).push(e)}function wn(e){return gn(1048580,e,!1)}function Sn(e){return gn(4,e,!1)}function vn(e,t=0){return gn(8|t,e,!0)}function kn(e,t=0){return gn(je|t,e,!0)}function _n(e){return gn(524320,e,!0)}function xn(e){var t=e.teardown;if(null!==t){const e=In,n=Fn;$n(!0),On(null);try{t.call(null)}finally{$n(e),On(n)}}}function Bn(e,t=!1){var n=e.first;for(e.first=e.last=null;null!==n;){const e=n.ac;null!==e&&mn(()=>{e.abort(ut)});var i=n.next;0!==(n.f&Ke)?n.parent=null:Mn(n,t),n=i}}function Mn(e,t=!0){var n=!1;!t&&0===(e.f&at)||null===e.nodes_start||null===e.nodes_end||(!function(e,t){for(;null!==e;){var n=e===t?null:cn(e);e.remove(),e=n}}(e.nodes_start,e.nodes_end),n=!0),Bn(e,t&&!n),ni(e,0),hi(e,tt);var i=e.transitions;if(null!==i)for(const a of i)a.stop();xn(e);var s=e.parent;null!==s&&null!==s.first&&An(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=e.ac=null}function An(e){var t=e.parent,n=e.prev,i=e.next;null!==n&&(n.next=i),null!==i&&(i.prev=n),null!==t&&(t.first===e&&(t.first=i),t.last===e&&(t.last=n))}function Cn(e,t,n=!0){var i=[];Tn(e,i,!0),function(e,t){var n=e.length;if(n>0){var i=()=>--n||t();for(var s of e)s.out(i)}else t()}(i,()=>{n&&Mn(e),t&&t()})}function Tn(e,t,n){if(0===(e.f&et)){if(e.f^=et,null!==e.transitions)for(const i of e.transitions)(i.is_global||n)&&t.push(i);for(var i=e.first;null!==i;){var s=i.next;Tn(i,t,!!(0!==(i.f&it)||0!==(i.f&qe)&&0!==(e.f&je))&&n),i=s}}}function Pn(e){Rn(e,!0)}function Rn(e,t){if(0!==(e.f&et)){e.f^=et,0===(e.f&Je)&&(hi(e,Qe),It(e));for(var n=e.first;null!==n;){var i=n.next;Rn(n,!!(0!==(n.f&it)||0!==(n.f&qe))&&t),n=i}if(null!==e.transitions)for(const n of e.transitions)(n.is_global||t)&&n.in()}}function Ln(e,t){for(var n=e.nodes_start,i=e.nodes_end;null!==n;){var s=n===i?null:cn(n);t.append(n),n=s}}let Wn=!1;function En(e){Wn=e}let In=!1;function $n(e){In=e}let Fn=null,Gn=!1;function On(e){Fn=e}let Dn=null;function Vn(e){Dn=e}let zn=null;function Nn(e){null!==Fn&&(null===zn?zn=[e]:zn.push(e))}let Hn=null,Un=0,jn=null;let qn=1,Kn=0,Xn=Kn;function Yn(e){Xn=e}function Jn(){return++qn}function Qn(e){var t=e.f;if(0!==(t&Qe))return!0;if(2&t&&(e.f&=-32769),0!==(t&Ze)){var n=e.deps;if(null!==n)for(var i=n.length,s=0;s<i;s++){var a=n[s];if(Qn(a)&&Ut(a),a.wv>e.wv)return!0}0!==(t&Ye)&&null===Bt&&hi(e,Je)}return!1}function Zn(e,t,n=!0){var i=e.reactions;if(null!==i&&!zn?.includes(e))for(var s=0;s<i.length;s++){var a=i[s];2&a.f?Zn(a,t,!1):t===a&&(n?hi(a,Qe):0!==(a.f&Je)&&hi(a,Ze),It(a))}}function ei(e){var t,n=Hn,i=Un,s=jn,a=Fn,o=zn,l=mt,r=Gn,h=Xn,c=e.f;Hn=null,Un=0,jn=null,Fn=96&c?null:e,zn=null,ft(e.ctx),Gn=!1,Xn=++Kn,null!==e.ac&&(mn(()=>{e.ac.abort(ut)}),e.ac=null);try{e.f|=rt;var u=(0,e.fn)(),d=e.deps;if(null!==Hn){var p;if(ni(e,Un),null!==d&&Un>0)for(d.length=Un+Hn.length,p=0;p<Hn.length;p++)d[Un+p]=Hn[p];else e.deps=d=Hn;if(Wn&&bn()&&0!==(e.f&Ye))for(p=Un;p<d.length;p++)((t=d[p]).reactions??(t.reactions=[])).push(e)}else null!==d&&Un<d.length&&(ni(e,Un),d.length=Un);if(yt()&&null!==jn&&!Gn&&null!==d&&!(6146&e.f))for(p=0;p<jn.length;p++)Zn(jn[p],e);return null!==a&&a!==e&&(Kn++,null!==jn&&(null===s?s=jn:s.push(...jn))),0!==(e.f&ht)&&(e.f^=ht),u}catch(m){return vt(m)}finally{e.f^=rt,Hn=n,Un=i,jn=s,Fn=a,zn=o,ft(l),Gn=r,Xn=h}}function ti(e,t){let n=t.reactions;if(null!==n){var i=We.call(n,e);if(-1!==i){var s=n.length-1;0===s?n=t.reactions=null:(n[i]=n[s],n.pop())}}null===n&&2&t.f&&(null===Hn||!Hn.includes(t))&&(hi(t,Ze),0!==(t.f&Ye)&&(t.f^=Ye,t.f&=-32769),Nt(t),ni(t,0))}function ni(e,t){var n=e.deps;if(null!==n)for(var i=t;i<n.length;i++)ti(e,n[i])}function ii(e){var t=e.f;if(0===(t&tt)){hi(e,Je);var n=Dn,i=Wn;Dn=e,Wn=!0;try{0!==(t&je)?function(e){for(var t=e.first;null!==t;){var n=t.next;0===(t.f&qe)&&Mn(t),t=n}}(e):Bn(e),xn(e);var s=ei(e);e.teardown="function"==typeof s?s:null,e.wv=qn}finally{Wn=i,Dn=n}}}function si(e){var t=!!(2&e.f);if(null!==Fn&&!Gn&&(!(null!==Dn&&0!==(Dn.f&tt))&&!zn?.includes(e))){var n=Fn.deps;if(0!==(Fn.f&rt))e.rv<Kn&&(e.rv=Kn,null===Hn&&null!==n&&n[Un]===e?Un++:null===Hn?Hn=[e]:Hn.includes(e)||Hn.push(e));else{(Fn.deps??(Fn.deps=[])).push(e);var i=e.reactions;null===i?e.reactions=[Fn]:i.includes(Fn)||i.push(Fn)}}if(In){if(qt.has(e))return qt.get(e);if(t){var s=e,a=s.v;return(0===(s.f&Je)&&null!==s.reactions||oi(s))&&(a=Ht(s)),qt.set(s,a),a}}else t&&!Bt?.has(e)&&(Qn(s=e)&&Ut(s),Wn&&bn()&&0===(s.f&Ye)&&ai(s));if(Bt?.has(e))return Bt.get(e);if(0!==(e.f&ht))throw e.v;return e.v}function ai(e){if(null!==e.deps){e.f^=Ye;for(const t of e.deps)(t.reactions??(t.reactions=[])).push(e),2&t.f&&0===(t.f&Ye)&&ai(t)}}function oi(e){if(e.v===Pe)return!0;if(null===e.deps)return!1;for(const t of e.deps){if(qt.has(t))return!0;if(2&t.f&&oi(t))return!0}return!1}function li(e){var t=Gn;try{return Gn=!0,e()}finally{Gn=t}}const ri=-7169;function hi(e,t){e.f=e.f&ri|t}function ci(e,t=new Set){if(!("object"!=typeof e||null===e||e instanceof EventTarget||t.has(e))){t.add(e),e instanceof Date&&e.getTime();for(let s in e)try{ci(e[s],t)}catch(n){}const i=De(e);if(i!==Object.prototype&&i!==Array.prototype&&i!==Map.prototype&&i!==Set.prototype&&i!==Date.prototype){const t=Fe(i);for(let i in t){const s=t[i].get;if(s)try{s.call(e)}catch(n){}}}}}const ui=new Set,di=new Set;let pi=null;function mi(e){var t=this,n=t.ownerDocument,i=e.type,s=e.composedPath?.()||[],a=s[0]||e.target;pi=e;var o=0,l=pi===e&&e.__root;if(l){var r=s.indexOf(l);if(-1!==r&&(t===document||t===window))return void(e.__root=t);var h=s.indexOf(t);if(-1===h)return;r<=h&&(o=r)}if((a=s[o]||e.target)!==t){Ie(e,"currentTarget",{configurable:!0,get:()=>a||n});var c=Fn,u=Dn;On(null),Vn(null);try{for(var d,p=[];null!==a;){var m=a.assignedSlot||a.parentNode||a.host||null;try{var f=a["__"+i];null==f||a.disabled&&e.target!==a||f.call(a,e)}catch(g){d?p.push(g):d=g}if(e.cancelBubble||m===t||null===m)break;a=m}if(d){for(let e of p)queueMicrotask(()=>{throw e});throw d}}finally{e.__root=t,delete e.currentTarget,On(c),Vn(u)}}}function fi(e,t){var n=Dn;null===n.nodes_start&&(n.nodes_start=e,n.nodes_end=t)}function gi(e,t){var n,i=!!(1&t),s=!!(2&t),a=!e.startsWith("<!>");return()=>{var t,o;void 0===n&&(t=a?e:"<!>"+e,(o=document.createElement("template")).innerHTML=t.replaceAll("<!>","\x3c!----\x3e"),n=o.content,i||(n=hn(n)));var l=s||an?document.importNode(n,!0):n.cloneNode(!0);i?fi(hn(l),l.lastChild):fi(l,l);return l}}function bi(e,t){null!==e&&e.before(t)}const yi=["touchstart","touchmove"];function wi(e){return yi.includes(e)}let Si=!0;const vi=new Map;let ki=new WeakMap;class _i{constructor(e,t=!0){ce(this,"anchor"),pe(this,I,new Map),pe(this,$,new Map),pe(this,F,new Map),pe(this,G,new Set),pe(this,O,!0),pe(this,D,()=>{var e=xt;if(de(this,I).has(e)){var t=de(this,I).get(e),n=de(this,$).get(t);if(n)Pn(n),de(this,G).delete(t);else{var i=de(this,F).get(t);i&&(de(this,$).set(t,i.effect),de(this,F).delete(t),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),n=i.effect)}for(const[t,n]of de(this,I)){if(de(this,I).delete(t),t===e)break;const i=de(this,F).get(n);i&&(Mn(i.effect),de(this,F).delete(n))}for(const[e,i]of de(this,$)){if(e===t||de(this,G).has(e))continue;const s=()=>{if(Array.from(de(this,I).values()).includes(e)){var t=document.createDocumentFragment();Ln(i,t),t.append(rn()),de(this,F).set(e,{effect:i,fragment:t})}else Mn(i);de(this,G).delete(e),de(this,$).delete(e)};de(this,O)||!n?(de(this,G).add(e),Cn(i,s,!1)):s()}}}),pe(this,V,e=>{de(this,I).delete(e);const t=Array.from(de(this,I).values());for(const[n,i]of de(this,F))t.includes(n)||(Mn(i.effect),de(this,F).delete(n))}),this.anchor=e,me(this,O,t)}ensure(e,t){var n=xt;!t||de(this,$).has(e)||de(this,F).has(e)||de(this,$).set(e,_n(()=>t(this.anchor)));de(this,I).set(n,e),de(this,D).call(this)}}function xi(e){var t,n;null===mt&&function(){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}(),Te&&null!==mt.l?(t=mt,n=t.l,n.u??(n.u={a:[],b:[],m:[]})).m.push(e):yn(()=>{const t=li(e);if("function"==typeof t)return t})}I=new WeakMap,$=new WeakMap,F=new WeakMap,G=new WeakMap,O=new WeakMap,D=new WeakMap,V=new WeakMap;const Bi={tick:e=>requestAnimationFrame(e),now:()=>performance.now(),tasks:new Set};function Mi(){const e=Bi.now();Bi.tasks.forEach(t=>{t.c(e)||(Bi.tasks.delete(t),t.f())}),0!==Bi.tasks.size&&Bi.tick(Mi)}function Ai(e,t){mn(()=>{e.dispatchEvent(new CustomEvent(t))})}function Ci(e){if("float"===e)return"cssFloat";if("offset"===e)return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return 1===t.length?t[0]:t[0]+t.slice(1).map(e=>e[0].toUpperCase()+e.slice(1)).join("")}function Ti(e){const t={},n=e.split(";");for(const i of n){const[e,n]=i.split(":");if(!e||void 0===n)break;t[Ci(e.trim())]=n.trim()}return t}const Pi=e=>e;function Ri(e,t,n,i,s){var a=1===i;if("function"==typeof t){var o,l=!1;return St(()=>{if(!l){var r=t({direction:a?"in":"out"});o=Ri(e,r,n,i,s)}}),{abort:()=>{l=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(n?.deactivate(),!t?.duration)return s(),{abort:ze,deactivate:ze,reset:ze,t:()=>i};const{delay:r=0,css:h,tick:c,easing:u=Pi}=t;var d=[];if(a&&void 0===n&&(c&&c(0,1),h)){var p=Ti(h(0,1));d.push(p,p)}var m=()=>1-i,f=e.animate(d,{duration:r,fill:"forwards"});return f.onfinish=()=>{f.cancel();var a=n?.t()??1-i;n?.abort();var o=i-a,l=t.duration*Math.abs(o),r=[];if(l>0){var d=!1;if(h)for(var p=Math.ceil(l/(1e3/60)),g=0;g<=p;g+=1){var b=a+o*u(g/p),y=Ti(h(b,1-b));r.push(y),d||(d="hidden"===y.overflow)}d&&(e.style.overflow="hidden"),m=()=>{var e=f.currentTime;return a+o*u(e/l)},c&&function(e){let t;0===Bi.tasks.size&&Bi.tick(Mi),new Promise(n=>{Bi.tasks.add(t={c:e,f:n})})}(()=>{if("running"!==f.playState)return!1;var e=m();return c(e,1-e),!0})}(f=e.animate(r,{duration:l,fill:"forwards"})).onfinish=()=>{m=()=>i,c?.(i,1-i),s()}},{abort:()=>{f&&(f.cancel(),f.effect=null,f.onfinish=ze)},deactivate:()=>{s=ze},reset:()=>{0===i&&c?.(1,0)},t:()=>m()}}function Li(e,t){return e===t||e?.[ct]===t}function Wi(e=!1){const t=mt,n=t.l.u;if(!n)return;let i=()=>function(e){if("object"==typeof e&&e&&!(e instanceof EventTarget))if(ct in e)ci(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];"object"==typeof n&&n&&ct in n&&ci(n)}}(t.s);if(e){let e=0,n={};const s=Ot(()=>{let i=!1;const s=t.s;for(const e in s)s[e]!==n[e]&&(n[e]=s[e],i=!0);return i&&e++,e});i=()=>si(s)}var s;n.b.length&&(s=()=>{Ei(t,i),He(n.b)},fn(),gn(1048584,s,!0)),yn(()=>{const e=li(()=>n.m.map(Ne));return()=>{for(const t of e)"function"==typeof t&&t()}}),n.a.length&&yn(()=>{Ei(t,i),He(n.a)})}function Ei(e,t){if(e.l.s)for(const n of e.l.s)si(n);t()}const Ii={width:1920,height:1080,backgroundColor:1710638,antialias:!0,resolution:Math.min(2,window.devicePixelRatio||1),autoDensity:!0,defaultBet:1,minBet:.1,maxBet:100,defaultCurrency:"USD",betModes:{BASE:{multiplier:1,badge:null},ANTE:{multiplier:1.25,badge:"knb_ante.webp"},BONUS:{multiplier:100,badge:"knb_bonus.webp"},SUPER:{multiplier:200,badge:"knb_super.webp"},EPIC:{multiplier:500,badge:"knb_epic.webp"}},timing:{spinDuration:2e3,turboDuration:500,reelOffset:100,anticipationDelay:500,winPresentationDelay:1e3,symbolLandDelay:50},autoSpinOptions:[10,25,50,100],states:{IDLE:"idle",LOADING:"loading",SPINNING:"spinning",REVEALING:"revealing",CELEBRATING:"celebrating",BONUS:"bonus",ERROR:"error"}};class $i{static findBone(e,t){return e&&t?e.skeleton.findBone(t):null}static getBoneWorldPosition(e,t){const n=this.findBone(e,t);return n?{x:n.worldX,y:n.worldY}:null}static setBoneTransform(e,t,n){const i=this.findBone(e,t);return i?(void 0!==n.x&&(i.x=n.x),void 0!==n.y&&(i.y=n.y),void 0!==n.rotation&&(i.rotation=n.rotation),void 0!==n.scaleX&&(i.scaleX=n.scaleX),void 0!==n.scaleY&&(i.scaleY=n.scaleY),void 0!==n.shearX&&(i.shearX=n.shearX),void 0!==n.shearY&&(i.shearY=n.shearY),!0):(console.warn(`‚ö†Ô∏è Bone "${t}" not found`),!1)}static setBoneScale(e,t,n,i){return this.setBoneTransform(e,t,{scaleX:n,scaleY:i??n})}static setBoneRotation(e,t,n){return this.setBoneTransform(e,t,{rotation:n})}static setBonePosition(e,t,n,i){return this.setBoneTransform(e,t,{x:n,y:i})}static listBones(e){return e?e.skeleton.bones.map(e=>e.data.name):[]}static findSlot(e,t){return e&&t?e.skeleton.findSlot(t):null}static setSlotColor(e,t,n,i,s,a=1){const o=this.findSlot(e,t);return o?(o.color.r=Math.max(0,Math.min(1,n)),o.color.g=Math.max(0,Math.min(1,i)),o.color.b=Math.max(0,Math.min(1,s)),o.color.a=Math.max(0,Math.min(1,a)),!0):(console.warn(`‚ö†Ô∏è Slot "${t}" not found`),!1)}static setSlotAlpha(e,t,n){const i=this.findSlot(e,t);return!!i&&(i.color.a=Math.max(0,Math.min(1,n)),!0)}static listSlots(e){return e?e.skeleton.slots.map(e=>e.data.name):[]}static getAnimationDuration(e,t){if(!e)return 0;const n=e.skeleton.data.findAnimation(t);return n?n.duration:0}static isAnimationPlaying(e,t){return!!e&&e.state.tracks.some(e=>e&&e.animation&&e.animation.name===t)}static getCurrentAnimation(e,t){if(!e)return null;const n=e.state.tracks[t];return n&&n.animation?n.animation.name:null}static listAnimations(e){return e?e.skeleton.data.animations.map(e=>e.name):[]}static getTrackEntry(e,t){return e&&e.state.tracks[t]||null}static setTrackAlpha(e,t,n){const i=this.getTrackEntry(e,t);return i?(i.alpha=Math.max(0,Math.min(1,n)),!0):(console.warn(`‚ö†Ô∏è Track ${t} not found or not playing`),!1)}static setTrackSpeed(e,t,n){const i=this.getTrackEntry(e,t);return!!i&&(i.timeScale=n,!0)}static clearTrack(e,t){e&&e.state.clearTrack(t)}static clearAllTracks(e){e&&e.state.clearTracks()}static listSkins(e){return e?e.skeleton.data.skins.map(e=>e.name):[]}static setSkin(e,t){if(!e)return!1;const n=e.skeleton.data.findSkin(t);return n?(e.skeleton.setSkin(n),e.skeleton.setSlotsToSetupPose(),!0):(console.warn(`‚ö†Ô∏è Skin "${t}" not found`),!1)}static debugPrintBones(e){e&&(console.group("ü¶¥ Spine Bones:"),e.skeleton.bones.forEach((e,t)=>{console.log(`[${t}] ${e.data.name}:`,{scale:`(${e.scaleX.toFixed(2)}, ${e.scaleY.toFixed(2)})`,pos:`(${e.x.toFixed(1)}, ${e.y.toFixed(1)})`,rotation:`${e.rotation.toFixed(1)}¬∞`,worldPos:`(${e.worldX.toFixed(1)}, ${e.worldY.toFixed(1)})`})}),console.groupEnd())}static debugPrintSlots(e){e&&(console.group("üé® Spine Slots:"),e.skeleton.slots.forEach((e,t)=>{const n=e.color;console.log(`[${t}] ${e.data.name}:`,{color:`rgba(${255*n.r|0}, ${255*n.g|0}, ${255*n.b|0}, ${n.a.toFixed(2)})`,attachment:e.attachment?.name||"none"})}),console.groupEnd())}static debugPrintAnimations(e){e&&(console.group("üé¨ Spine Animations:"),e.skeleton.data.animations.forEach((e,t)=>{console.log(`[${t}] ${e.name}: ${e.duration.toFixed(2)}s`)}),console.groupEnd())}static debugPrintTracks(e){e&&(console.group("üéµ Active Tracks:"),e.state.tracks.forEach((e,t)=>{e&&e.animation&&console.log(`[${t}] ${e.animation.name}:`,{alpha:e.alpha.toFixed(2),timeScale:e.timeScale.toFixed(2),trackTime:e.trackTime.toFixed(2),loop:e.loop})}),console.groupEnd())}static debugPrintSkeletonInfo(e){e&&(console.group("üìä Spine Skeleton Info:"),console.log("Bones:",this.listBones(e).length),console.log("Slots:",this.listSlots(e).length),console.log("Animations:",this.listAnimations(e).length),console.log("Skins:",this.listSkins(e).length),console.groupEnd(),this.debugPrintBones(e),this.debugPrintSlots(e),this.debugPrintAnimations(e),this.debugPrintTracks(e))}}class Fi extends ge{constructor(){super(),ce(this,"backgroundSpine",null),ce(this,"reelhouseSpine",null),ce(this,"particaleSpine",null),ce(this,"screensSpine",null),ce(this,"symbolsSpine",null),this.isRenderGroup=!0,this.label="SpineManager"}async init(){console.log("ü¶¥ Initializing Spine animations...");try{this.backgroundSpine=this.createSpine("bg_spine"),this.backgroundSpine&&(this.backgroundSpine.x=0,this.backgroundSpine.y=0,this.backgroundSpine.scale.set(1),this.addChild(this.backgroundSpine),console.log("‚úÖ Background spine created (eager)")),this.reelhouseSpine=this.createSpine("reel_spine"),this.reelhouseSpine&&(this.reelhouseSpine.x=0,this.reelhouseSpine.y=0,this.reelhouseSpine.scale.set(.8),this.addChild(this.reelhouseSpine),console.log("‚úÖ Reelhouse spine created (eager)")),console.log("‚úÖ Spine animations initialized (lazy loading ready for bonus resources)")}catch(e){throw console.error("‚ùå Failed to initialize Spine animations:",e),e}}ensureBonusResources(){this.screensSpine||(console.log("üîÑ Lazy loading screens spine..."),this.screensSpine=this.createSpine("screen_spine"),this.screensSpine&&(this.screensSpine.x=0,this.screensSpine.y=0,this.screensSpine.scale.set(1),this.addChild(this.screensSpine),this.screensSpine.visible=!1,console.log("‚úÖ Screens spine lazy loaded")))}ensureSymbolResources(){this.symbolsSpine||(console.log("üîÑ Lazy loading symbols spine..."),this.symbolsSpine=this.createSpine("symbol_spine"),this.symbolsSpine&&(this.symbolsSpine.x=0,this.symbolsSpine.y=0,this.symbolsSpine.scale.set(1),this.addChild(this.symbolsSpine),this.symbolsSpine.visible=!1,console.log("‚úÖ Symbols spine lazy loaded")))}createSpine(e){try{const t=`${e}_skeleton`,n=`${e}_atlas`,i=Me.from({skeleton:t,atlas:n});return i?(console.log(`‚úÖ Created Spine instance: ${e}`),i):(console.warn(`‚ö†Ô∏è Failed to create Spine instance for ${e}`),null)}catch(t){return console.error(`‚ùå Error creating Spine instance for ${e}:`,t),null}}playBackgroundAnimation(e,t=!0){if(this.backgroundSpine)try{this.backgroundSpine.state.setAnimation(0,e,t)}catch(n){console.warn(`‚ö†Ô∏è Failed to play background animation: ${e}`,n)}}playReelhouseAnimation(e,t,n=!0){if(this.reelhouseSpine)try{this.reelhouseSpine.state.setAnimation(e,t,n)}catch(i){console.warn(`‚ö†Ô∏è Failed to play reelhouse animation: ${t}`,i)}}playPaylineAnimation(e){if(!this.reelhouseSpine)return;const t=7+e,n=`payline_${e}`;try{this.reelhouseSpine.state.setAnimation(t,n,!1),this.reelhouseSpine.state.addEmptyAnimation(t,0,0)}catch(i){}}clearPaylineAnimations(){if(this.reelhouseSpine)for(let t=7;t<17;t++)try{this.reelhouseSpine.state.setEmptyAnimation(t,0)}catch(e){}}playParticleAnimation(e,t=!0){if(this.particaleSpine)try{this.particaleSpine.visible=!0,this.particaleSpine.state.setAnimation(0,e,t)}catch(n){console.warn(`‚ö†Ô∏è Failed to play particle animation: ${e}`,n)}}playScreensAnimation(e,t=!1){if(this.ensureBonusResources(),this.screensSpine)try{this.screensSpine.visible=!0,this.screensSpine.state.setAnimation(0,e,t)}catch(n){console.warn(`‚ö†Ô∏è Failed to play screens animation: ${e}`,n)}}hideScreens(){this.screensSpine&&(this.screensSpine.visible=!1)}playSymbolAnimation(e,t=!1){if(this.ensureSymbolResources(),this.symbolsSpine)try{this.symbolsSpine.visible=!0,this.symbolsSpine.state.setAnimation(0,e,t),console.log(`üé¨ Playing symbol animation: ${e}`)}catch(n){console.warn(`‚ö†Ô∏è Failed to play symbol animation: ${e}`,n)}}hideSymbolAnimations(){this.symbolsSpine&&(this.symbolsSpine.visible=!1)}setReelhouseBoneScale(e,t,n){if(!this.reelhouseSpine)return void console.warn("‚ö†Ô∏è Reelhouse spine not loaded yet");$i.setBoneScale(this.reelhouseSpine,e,t,n)?console.log(`ü¶¥ Bone "${e}" scaled to (${t}, ${n??t})`):console.log("Available bones:",this.listReelhouseBones())}listReelhouseBones(){return $i.listBones(this.reelhouseSpine)}setReelhouseTrackAlpha(e,t){if(!this.reelhouseSpine)return void console.warn("‚ö†Ô∏è Reelhouse spine not loaded yet");$i.setTrackAlpha(this.reelhouseSpine,e,t)&&console.log(`üé® Track ${e} alpha set to ${t.toFixed(2)}`)}setReelhouseTrackSpeed(e,t){if(!this.reelhouseSpine)return void console.warn("‚ö†Ô∏è Reelhouse spine not loaded yet");$i.setTrackSpeed(this.reelhouseSpine,e,t)&&console.log(`‚ö° Track ${e} speed set to ${t.toFixed(2)}x`)}debugReelhouseBones(){this.reelhouseSpine?$i.debugPrintBones(this.reelhouseSpine):console.warn("‚ö†Ô∏è Reelhouse spine not loaded yet")}debugReelhouseInfo(){this.reelhouseSpine?$i.debugPrintSkeletonInfo(this.reelhouseSpine):console.warn("‚ö†Ô∏è Reelhouse spine not loaded yet")}enterBonusMode(){console.log("üé∞ Entering bonus mode animations..."),this.ensureBonusResources(),this.playBackgroundAnimation("bonus_bg_anim",!0),this.playReelhouseAnimation(0,"bonus_reel_anim",!0),this.playScreensAnimation("bonus_screen_in",!1)}exitBonusMode(){console.log("üé∞ Exiting bonus mode animations..."),this.playBackgroundAnimation("idle",!0),this.playReelhouseAnimation(0,"splash_intro",!1),this.hideScreens()}getAvailableAnimations(e){let t=null;switch(e){case"background":t=this.backgroundSpine;break;case"reelhouse":t=this.reelhouseSpine;break;case"screens":t=this.screensSpine;break;case"symbols":t=this.symbolsSpine}return t&&t.skeleton?.data?.animations?t.skeleton.data.animations.map(e=>e.name):[]}destroy(e){this.backgroundSpine&&(this.backgroundSpine.destroy(),this.backgroundSpine=null),this.reelhouseSpine&&(this.reelhouseSpine.destroy(),this.reelhouseSpine=null),this.screensSpine&&(this.screensSpine.destroy(),this.screensSpine=null),this.symbolsSpine&&(this.symbolsSpine.destroy(),this.symbolsSpine=null),super.destroy(e)}}const Gi={spriteFile:"/assets/audio/knb_sounds.ogg",spriteManifest:"/assets/audio/knb_sounds.json",bgm:{base:"knb_base_bgm",bonus:"knb_bonus_bgm",super:"knb_super_bgm",epic:"knb_epic_bgm",ambience:"knb_ambience"},sfx:{spinStart:"knb_spin_start",reelSpin:"knb_reel_spin",reelStop1:"knb_reel_stop_1",reelStop2:"knb_reel_stop_2",reelStop3:"knb_reel_stop_3",reelStop4:"knb_reel_stop_4",reelStop5:"knb_reel_stop_5",wildLand:"knb_wild_land",bonusLand1:"knb_bonus_land_1",bonusLand2:"knb_bonus_land_2",bonusLand3:"knb_bonus_land_3",bonusLand4:"knb_bonus_land_4",bonusLand5:"knb_bonus_land_5",highSymbolWin:"knb_high_symbol_win",lowSymbolWin:"knb_low_symbol_win",winSmall:"knb_smallwin",winBig:"knb_bigwin",winMega:"knb_megawin",winSuper:"knb_superwin",winEpic:"knb_epicwin",winMax:"knb_maxwin",winCount:"knb_win_count",bonusWin:"knb_bonus_win",winMultApplied:"knb_winmult_applied",finalWinEnd:"knb_finalwin_end",anticipation:"knb_anticipation",gachaLand:"knb_gacha_land",gachaReveal:"knb_gacha_reveal",gachaRevealBlue:"knb_gacha_reveal_blue",gachaRevealGold:"knb_gacha_reveal_gold",gachaRevealGreen:"knb_gacha_reveal_green",gachaRevealPink:"knb_gacha_reveal_pink",gachaWin:"knb_gacha_win",fsBonusIntro:"knb_fs_bonus_intro",fsSuperIntro:"knb_fs_super_intro",fsEpicIntro:"knb_fs_epic_intro",fsOutro:"knb_fs_outro",fsTotalIntro:"knb_fs_total_intro",globalMultUpdate:"knb_globalmult_update",click:"knb_click",buyClick:"knb_buy_click",gameEnter:"knb_game_enter",betLevel:"shared_betlevel",totalWin:"shared_totalwin",totalWinBig:"shared_totalwin_big",totalWinCoins:"shared_totalwin_coins",voiceIrasshaimaseA:"knb_voice_irasshaimase_a",voiceIrasshaimaseB:"knb_voice_irasshaimase_b",voiceIrasshaimaseC:"knb_voice_irasshaimase_c",voiceReceiptA:"knb_voice_receipt_a",voiceReceiptB:"knb_voice_receipt_b",voiceReceiptC:"knb_voice_receipt_c",voiceReceiptD:"knb_voice_receipt_d",voiceArigatouA:"knb_voice_argatougozimsu_a",voiceArigatouB:"knb_voice_argatougozimsu_b",voiceArigatouC:"knb_voice_argatougozimsu_c",voiceNextCustomerA:"knb_voice_nextCustomer_a",voiceNextCustomerB:"knb_voice_nextCustomer_b",voiceNextCustomerC:"knb_voice_nextCustomer_c",voiceNextCustomerD:"knb_voice_nextCustomer_d"},ambientVoices:["knb_voice_receipt_a","knb_voice_receipt_b","knb_voice_argatougozimsu_a","knb_voice_argatougozimsu_b","knb_voice_argatougozimsu_c","knb_voice_nextCustomer_a"],volumes:{spinStart:.7,reelStop:.6,bonusLandTurbo:.3,bonusLandNormal:1,gachaReveal:.9,freeSpinsIntro:.6,globalMultUpdate:.6,totalWin:.6,finalWinEnd:.6},defaultVolumes:{master:1,bgm:.7,sfx:.8},mixingPresets:{base:{baseBgm:1,bonusBgm:0,superBgm:0,epicBgm:0,ambience:.9},anticipation:{baseBgm:.2,bonusBgm:0,superBgm:0,epicBgm:0,ambience:.4},bonusIntro:{baseBgm:.4,bonusBgm:0,superBgm:0,epicBgm:0,ambience:.1},bonus:{baseBgm:0,bonusBgm:1,superBgm:0,epicBgm:0,ambience:.4},super:{baseBgm:0,bonusBgm:0,superBgm:1,epicBgm:0,ambience:.3},epic:{baseBgm:0,bonusBgm:0,superBgm:0,epicBgm:1,ambience:.2}},ambientVoiceInterval:{min:9e4,max:1e5},fadeDuration:500,crossfadeDuration:500};const Oi=new class{constructor(){ce(this,"soundSprite",null),ce(this,"bgmTracks",new Map),ce(this,"currentMixingPreset","base"),ce(this,"currentBgmTrack","base"),ce(this,"isMuted",!1),ce(this,"masterVolume",Gi.defaultVolumes.master),ce(this,"bgmVolume",Gi.defaultVolumes.bgm),ce(this,"sfxVolume",Gi.defaultVolumes.sfx),ce(this,"reelSpinId",null),ce(this,"anticipationId",null),ce(this,"winCountId",null),ce(this,"gachaRevealId",null),ce(this,"bonusIntroId",null),ce(this,"ambientVoiceTimer",null),ce(this,"bonusLandCount",0),ce(this,"handleVisibilityChange",async()=>{try{const e=Ae.Howler.ctx;if(!e)return;document.hidden?"running"===e.state&&await e.suspend():"suspended"===e.state&&await e.resume()}catch(e){console.error("Failed toggling audio context visibility state",e)}})}async init(){console.log("üîä Initializing audio system...");try{const e=await this.loadManifest();this.soundSprite=new Ae.Howl({src:[Gi.spriteFile],sprite:e,volume:this.masterVolume,onload:()=>{console.log("‚úÖ Audio sprite loaded")},onloaderror:(e,t)=>{console.error("‚ùå Audio sprite load error:",t)}}),document.addEventListener("visibilitychange",this.handleVisibilityChange),console.log("‚úÖ Audio system initialized")}catch(e){throw console.error("‚ùå Failed to initialize audio:",e),e}}async loadManifest(){try{const e=await fetch(Gi.spriteManifest),t=await e.json();return t.sprite||t}catch(e){return console.error("‚ùå Failed to load audio manifest:",e),{}}}play(e,t=!1,n=1){if(!this.soundSprite||this.isMuted)return null;const i=this.soundSprite.play(e);return this.soundSprite.volume(n*this.sfxVolume,i),t&&this.soundSprite.loop(!0,i),i}fade(e,t,n,i){this.soundSprite&&this.soundSprite.fade(t*this.sfxVolume,n*this.sfxVolume,i,e)}stopSound(e,t=0){if(this.soundSprite&&null!==e)if(t>0){const n=this.soundSprite.volume(e);this.soundSprite.fade(n,0,t,e),setTimeout(()=>this.soundSprite?.stop(e),t)}else this.soundSprite.stop(e)}startBGM(){if(!this.soundSprite)return;const e=this.soundSprite.play(Gi.bgm.ambience);this.bgmTracks.set("ambience",e),this.soundSprite.volume(.9*this.bgmVolume,e),this.soundSprite.loop(!0,e),Object.entries(Gi.bgm).forEach(([e,t])=>{if("ambience"===e)return;const n=this.soundSprite.play(t);this.bgmTracks.set(e,n);const i=Gi.mixingPresets.base[`${e}Bgm`]??0;this.soundSprite.volume(i*this.bgmVolume,n),this.soundSprite.loop(!0,n)}),this.currentBgmTrack="base",this.startAmbientVoiceLoop()}playGameEnter(){this.play("knb_game_enter",!1,1),this.play("knb_voice_irasshaimase_c",!1,1)}startAmbientVoiceLoop(){this.stopAmbientVoiceLoop();const{min:e,max:t}=Gi.ambientVoiceInterval,n=e+Math.random()*(t-e);this.ambientVoiceTimer=setTimeout(()=>{const e=Gi.ambientVoices,t=e[Math.floor(Math.random()*e.length)],n="bonus"===this.currentMixingPreset?0:1;this.play(t,!1,n),this.startAmbientVoiceLoop()},n)}stopAmbientVoiceLoop(){this.ambientVoiceTimer&&(clearTimeout(this.ambientVoiceTimer),this.ambientVoiceTimer=null)}setMixingPreset(e){if(!this.soundSprite)return;this.currentMixingPreset=e;const t=Gi.mixingPresets[e],n=Gi.crossfadeDuration;Object.entries(Gi.bgm).forEach(([e,i])=>{const s=this.bgmTracks.get(e);if(void 0===s)return;const a=(t[`${e}Bgm`]??0)*this.bgmVolume,o=this.soundSprite.volume(s);this.soundSprite.fade(o,a,n,s)})}playSpinStart(){this.bonusLandCount=0,this.stopWinCount(),this.play("knb_spin_start",!1,Gi.volumes.spinStart),this.reelSpinId=this.play("knb_reel_spin",!0,1)}playReelStop(e){const t=Math.min(5,Math.max(1,e+1));this.play(`knb_reel_stop_${t}`,!1,Gi.volumes.reelStop),4===e&&(null!==this.reelSpinId&&(this.fade(this.reelSpinId,1,0,200),setTimeout(()=>{this.stopSound(this.reelSpinId),this.reelSpinId=null},200)),this.endAnticipation())}playWildLand(){this.play("knb_wild_land",!1,1)}playBonusLand(e=!1){this.bonusLandCount++;const t=Math.min(5,this.bonusLandCount),n=e?Gi.volumes.bonusLandTurbo:Gi.volumes.bonusLandNormal;this.play(`knb_bonus_land_${t}`,!1,n)}playGachaLand(){this.play("knb_gacha_land",!1,1)}playSymbolWin(e){this.play(e?"knb_high_symbol_win":"knb_low_symbol_win",!1,1)}playBonusWin(){this.play("knb_bonus_win",!1,1)}startAnticipation(){null===this.anticipationId&&(this.setMixingPreset("anticipation"),this.anticipationId=this.play("knb_anticipation",!0,1))}endAnticipation(){null!==this.anticipationId&&(this.fade(this.anticipationId,1,0,400),setTimeout(()=>{this.stopSound(this.anticipationId),this.anticipationId=null},400),this.setMixingPreset("base"))}anticipate(e,t){t&&t.hasAnticipation&&this.startAnticipation()}startWinCount(e=!1){if(this.winCountId=this.play("knb_win_count",!0,1),null!==this.winCountId&&this.soundSprite){const t=e?2:1.5,n={rate:1};Ce.to(n,{rate:t,duration:4,onUpdate:()=>{null!==this.winCountId&&this.soundSprite?.rate(n.rate,this.winCountId)}})}}stopWinCount(){null!==this.winCountId&&(Ce.killTweensOf(this.soundSprite),this.fade(this.winCountId,1,0,200),setTimeout(()=>{this.stopSound(this.winCountId),this.winCountId=null},200))}playFinalWinEnd(){this.stopWinCount(),this.play("knb_finalwin_end",!1,Gi.volumes.finalWinEnd);const e=Gi.ambientVoices,t=e[Math.floor(Math.random()*(e.length-1))];setTimeout(()=>this.play(t,!1,1),400)}playWinMultApplied(){this.play("knb_winmult_applied",!1,1)}playTotalWin(e){e>50?this.play("shared_totalwin_big",!1,Gi.volumes.totalWin):e>1&&this.play("shared_totalwin",!1,Gi.volumes.totalWin),this.play("shared_totalwin_coins",!1,Gi.volumes.totalWin)}playBigWinLevel(e){this.play({big:"knb_bigwin",super:"knb_superwin",mega:"knb_megawin",epic:"knb_epicwin",max:"knb_maxwin"}[e]||"knb_bigwin",!1,1),this.play("knb_bigwin",!1,1)}playGachaReveal(){this.gachaRevealId=this.play("knb_gacha_reveal",!0,Gi.volumes.gachaReveal)}playGachaBallReveal(e){null!==this.gachaRevealId&&(this.fade(this.gachaRevealId,.9,0,300),setTimeout(()=>{this.stopSound(this.gachaRevealId),this.gachaRevealId=null},300)),this.play(`knb_gacha_reveal_${e}`,!1,Gi.volumes.gachaReveal)}playGachaWin(){this.play("knb_gacha_win",!1,1)}playGlobalMultUpdate(){this.play("knb_globalmult_update",!1,Gi.volumes.globalMultUpdate)}playBonusIntro(e,t=!0){if(t){const e=this.bgmTracks.get("base");void 0!==e&&this.soundSprite?.fade(1*this.bgmVolume,.4*this.bgmVolume,500,e)}else{const e=this.bgmTracks.get("bonus");void 0!==e&&this.soundSprite?.fade(1*this.bgmVolume,.4*this.bgmVolume,500,e)}const n=this.bgmTracks.get("ambience");void 0!==n&&this.soundSprite?.fade(.4*this.bgmVolume,.1*this.bgmVolume,500,n),this.bonusIntroId=this.play(`knb_fs_${e}_intro`,!1,Gi.volumes.freeSpinsIntro)}playBonusOutro(e,t=!1){this.play("knb_fs_outro",!1,1),null!==this.bonusIntroId&&(this.fade(this.bonusIntroId,1,0,500),setTimeout(()=>{this.stopSound(this.bonusIntroId),this.bonusIntroId=null},500));const n="bonus"===e?"bonus":"super"===e?"super":"epic",i=this.bgmTracks.get(n);if(t){void 0!==i&&this.soundSprite?.fade(1*this.bgmVolume,0,500,i);const e=this.bgmTracks.get("base");void 0!==e&&(this.soundSprite?.seek(0,e),this.soundSprite?.fade(.1*this.bgmVolume,1*this.bgmVolume,500,e));const t=this.bgmTracks.get("ambience");void 0!==t&&this.soundSprite?.fade(.1*this.bgmVolume,.4*this.bgmVolume,500,t),this.currentBgmTrack="base"}else{const e=this.bgmTracks.get("base");if(void 0!==e&&this.soundSprite?.fade(.4*this.bgmVolume,0,500,e),"base"!==this.currentBgmTrack&&this.currentBgmTrack!==n){const e=this.bgmTracks.get(this.currentBgmTrack);void 0!==e&&this.soundSprite?.fade(1*this.bgmVolume,0,500,e)}void 0!==i&&(this.soundSprite?.seek(0,i),this.soundSprite?.fade(0,1*this.bgmVolume,500,i)),this.currentBgmTrack=n}}playClick(e=!1){this.play(e?"knb_buy_click":"knb_click",!1,1)}playBetLevel(e=1){const t=this.play("shared_betlevel",!1,1);null!==t&&this.soundSprite&&this.soundSprite.rate(e,t)}playBonusRevealSpinStart(){this.bonusLandCount=0,setTimeout(()=>this.play("knb_spin_start",!1,.6),300)}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e)),this.soundSprite&&this.soundSprite.volume(this.masterVolume)}setBgmVolume(e){this.bgmVolume=Math.max(0,Math.min(1,e)),this.setMixingPreset(this.currentMixingPreset)}setSfxVolume(e){this.sfxVolume=Math.max(0,Math.min(1,e))}mute(){this.isMuted=!0,Ae.Howler.mute(!0)}unmute(){this.isMuted=!1,Ae.Howler.mute(!1)}toggleMute(){this.isMuted?this.unmute():this.mute()}stopAll(){this.soundSprite&&this.soundSprite.stop()}destroy(){this.stopAmbientVoiceLoop(),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.soundSprite&&(this.soundSprite.unload(),this.soundSprite=null),this.bgmTracks.clear()}};const Di=new class{constructor(){ce(this,"handlers"),ce(this,"onceHandlers"),this.handlers=new Map,this.onceHandlers=new Map}on(e,t){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),{unsubscribe:()=>this.off(e,t)}}once(e,t){return this.onceHandlers.has(e)||this.onceHandlers.set(e,new Set),this.onceHandlers.get(e).add(t),{unsubscribe:()=>{const n=this.onceHandlers.get(e);n&&n.delete(t)}}}off(e,t){const n=this.handlers.get(e);n&&n.delete(t)}async emit(e){const t=e.type,n=this.handlers.get(t);if(n){const i=[];for(const a of n)try{const t=a(e);t instanceof Promise&&i.push(t)}catch(s){console.error(`Error in event handler for ${t}:`,s)}await Promise.all(i)}const i=this.onceHandlers.get(t);if(i){const n=[];for(const a of i)try{const t=a(e);t instanceof Promise&&n.push(t)}catch(s){console.error(`Error in once handler for ${t}:`,s)}await Promise.all(n),this.onceHandlers.delete(t)}}clear(e){e?(this.handlers.delete(e),this.onceHandlers.delete(e)):(this.handlers.clear(),this.onceHandlers.clear())}getHandlerCount(e){return(this.handlers.get(e)?.size??0)+(this.onceHandlers.get(e)?.size??0)}hasHandlers(e){return this.getHandlerCount(e)>0}destroy(){this.clear()}};z=new WeakMap,N=new WeakMap,H=new WeakMap,U=new WeakMap,j=new WeakMap,q=new WeakMap,K=new WeakMap,X=new WeakMap,Y=new WeakMap,J=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,ie=new WeakMap,se=new WeakMap,ae=new WeakMap,oe=new WeakMap,le=new WeakMap;const Vi=new class{constructor(){pe(this,z,Yt(nn(Ii.states.LOADING))),pe(this,N,Yt(0)),pe(this,H,Yt(1e3)),pe(this,U,Yt(nn(Ii.defaultBet))),pe(this,j,Yt("BASE")),pe(this,q,Yt(nn(Ii.defaultCurrency))),pe(this,K,Yt(0)),pe(this,X,Yt(0)),pe(this,Y,Yt(null)),pe(this,J,Yt(0)),pe(this,Q,Yt(0)),pe(this,Z,Yt(!1)),pe(this,ee,Yt(!1)),pe(this,te,Yt(0)),pe(this,ne,Yt(!1)),pe(this,ie,Yt(!0)),pe(this,se,Yt(!1)),pe(this,ae,Yt(!1)),pe(this,oe,Yt(!1)),pe(this,le,Yt(!1))}get state(){return si(de(this,z))}set state(e){Qt(de(this,z),e,!0)}get loadingProgress(){return si(de(this,N))}set loadingProgress(e){Qt(de(this,N),e,!0)}get balance(){return si(de(this,H))}set balance(e){Qt(de(this,H),e,!0)}get betAmount(){return si(de(this,U))}set betAmount(e){Qt(de(this,U),e,!0)}get betMode(){return si(de(this,j))}set betMode(e){Qt(de(this,j),e,!0)}get currency(){return si(de(this,q))}set currency(e){Qt(de(this,q),e,!0)}get winAmount(){return si(de(this,K))}set winAmount(e){Qt(de(this,K),e,!0)}get totalWin(){return si(de(this,X))}set totalWin(e){Qt(de(this,X),e,!0)}get currentBoard(){return si(de(this,Y))}set currentBoard(e){Qt(de(this,Y),e,!0)}get freeSpinsRemaining(){return si(de(this,J))}set freeSpinsRemaining(e){Qt(de(this,J),e,!0)}get freeSpinsTotal(){return si(de(this,Q))}set freeSpinsTotal(e){Qt(de(this,Q),e,!0)}get inFreeSpins(){return si(de(this,Z))}set inFreeSpins(e){Qt(de(this,Z),e,!0)}get isAutoSpin(){return si(de(this,ee))}set isAutoSpin(e){Qt(de(this,ee),e,!0)}get autoSpinRemaining(){return si(de(this,te))}set autoSpinRemaining(e){Qt(de(this,te),e,!0)}get isSpinning(){return si(de(this,ne))}set isSpinning(e){Qt(de(this,ne),e,!0)}get canSpin(){return si(de(this,ie))}set canSpin(e){Qt(de(this,ie),e,!0)}get showPaytable(){return si(de(this,se))}set showPaytable(e){Qt(de(this,se),e,!0)}get showSettings(){return si(de(this,ae))}set showSettings(e){Qt(de(this,ae),e,!0)}get turboMode(){return si(de(this,oe))}set turboMode(e){Qt(de(this,oe),e,!0)}get skipEnabled(){return si(de(this,le))}set skipEnabled(e){Qt(de(this,le),e,!0)}get adjustedBetAmount(){const e=Ii.betModes[this.betMode].multiplier;return this.betAmount*e}get canAffordBet(){return this.balance>=this.adjustedBetAmount}setState(e){console.log(`üéÆ State change: ${this.state} ‚Üí ${e}`),this.state=e}setLoadingProgress(e){this.loadingProgress=Math.max(0,Math.min(100,e))}updateBalance(e){this.balance=e}placeBet(){return this.canAffordBet?(this.balance-=this.adjustedBetAmount,!0):(console.warn("‚ö†Ô∏è Insufficient balance for bet"),!1)}addWinnings(e){this.balance+=e,this.winAmount=e,this.totalWin+=e}setBetAmount(e){this.betAmount=Math.max(Ii.minBet,Math.min(e,Ii.maxBet))}setBetMode(e){this.betMode=e}startAutoSpin(e){this.isAutoSpin=!0,this.autoSpinRemaining=e}stopAutoSpin(){this.isAutoSpin=!1,this.autoSpinRemaining=0}decrementAutoSpin(){this.autoSpinRemaining>0&&(this.autoSpinRemaining--,0===this.autoSpinRemaining&&this.stopAutoSpin())}startFreeSpins(e){this.freeSpinsTotal=e,this.freeSpinsRemaining=e,this.inFreeSpins=!0}decrementFreeSpins(){this.freeSpinsRemaining>0&&(this.freeSpinsRemaining--,0===this.freeSpinsRemaining&&this.endFreeSpins())}endFreeSpins(){this.inFreeSpins=!1,this.freeSpinsRemaining=0,this.freeSpinsTotal=0}setBoard(e){this.currentBoard=e}setCanSpin(e){this.canSpin=e}setSpinning(e){this.isSpinning=e}toggleTurbo(){this.turboMode=!this.turboMode}toggleSkip(){this.skipEnabled=!this.skipEnabled}resetWin(){this.winAmount=0}reset(){this.state=Ii.states.IDLE,this.winAmount=0,this.currentBoard=null,this.isSpinning=!1,this.canSpin=!0,this.skipEnabled=!1}};function zi(e){return new Promise(t=>setTimeout(t,e))}const Ni=new class{constructor(e=""){ce(this,"baseUrl"),ce(this,"authToken",null),this.baseUrl=e||this.getDefaultBaseUrl()}getDefaultBaseUrl(){return"mock"}setAuthToken(e){this.authToken=e}async request(e,t="GET",n){if("mock"===this.baseUrl)return this.mockRequest(e,t,n);const i=`${this.baseUrl}${e}`,s={"Content-Type":"application/json"};this.authToken&&(s.Authorization=`Bearer ${this.authToken}`);const a={method:t,headers:s,body:n?JSON.stringify(n):void 0};try{const e=await fetch(i,a);if(!e.ok)throw new Error(`API error: ${e.status} ${e.statusText}`);return await e.json()}catch(o){throw console.error(`‚ùå API request failed: ${e}`,o),o}}async mockRequest(e,t,n){if(console.log(`üîß Mock API request: ${t} ${e}`,n),await new Promise(e=>setTimeout(e,500)),"/wallet/play"===e)return this.mockPlayResponse(n);if("/wallet/balance"===e)return this.mockBalanceResponse();throw new Error(`Mock endpoint not implemented: ${e}`)}mockPlayResponse(e){const t=["h1","h2","h3","h4","h5","l1","l2","l3","l4","l5"],n=[];for(let a=0;a<5;a++){const e=[];for(let n=0;n<3;n++){const n=t[Math.floor(Math.random()*t.length)];e.push(n)}n.push(e.join(","))}const i=n.join("|"),s=Math.random()<.1?e.amount*(10*Math.random()+1):0;return{success:!0,board:i,win:s,balance:1e3-e.amount+s,bonusTriggered:Math.random()<.05,freeSpinsAwarded:Math.random()<.05?10:void 0}}mockBalanceResponse(){return{balance:1e3,currency:"USD"}}async authenticate(e){const t=await this.request("/wallet/authenticate","POST",e);this.setAuthToken(t.token)}async play(e){return await this.request("/wallet/play","POST",e)}async getBalance(){return await this.request("/wallet/balance")}async endRound(){await this.request("/wallet/end-round","POST")}parseBoardState(e){const t=e.board.split("|").map(e=>e.split(","));return{symbols:t,wins:[],totalWin:e.win,scatterCount:this.countScatters(t),bonusTriggered:e.bonusTriggered??!1}}countScatters(e){let t=0;for(const n of e)for(const e of n)"scatter"===e&&t++;return t}},Hi={background:{skeleton:"/assets/spine/knb_background.skel",atlas:"/assets/spine/knb_master.atlas",alias:"bg_spine"},reelhouse:{skeleton:"/assets/spine/knb_reelhouse.skel",atlas:"/assets/spine/knb_master.atlas",alias:"reel_spine"},screens:{skeleton:"/assets/spine/knb_screens.skel",atlas:"/assets/spine/knb_master.atlas",alias:"screen_spine"},symbols:{skeleton:"/assets/spine/knb_symbols.skel",atlas:"/assets/spine/knb_master.atlas",alias:"symbol_spine"}},Ui={master:{src:"/assets/spine/knb_master.atlas",alias:"master_atlas"},blue:{src:"/assets/sprites/knb_blue.xml",alias:"blue_atlas"},pink:{src:"/assets/sprites/knb_pink.xml",alias:"pink_atlas"}},ji={logo:"/assets/images/paperclip_full_logo.webp",loader:"/assets/images/knb_loader.webp",loaderBg:"/assets/images/knb_loader_bg.webp",continue:"/assets/images/continue.webp",anteBadge:"/assets/images/knb_ante.webp",bonusBadge:"/assets/images/knb_bonus.webp",superBadge:"/assets/images/knb_super.webp",epicBadge:"/assets/images/knb_epic.webp",blueFont:"/assets/sprites/knb_blue.webp",pinkFont:"/assets/sprites/knb_pink.webp"},qi={sounds:"/assets/audio/knb_sounds.ogg"};const Ki=new class{constructor(){ce(this,"progress",0),ce(this,"onProgressCallback",null),ce(this,"isInitialized",!1)}setProgressCallback(e){this.onProgressCallback=e}getProgress(){return this.progress}async initAssets(){this.isInitialized?console.log("‚ÑπÔ∏è Assets already initialized"):(console.log("üé® Initializing PixiJS Assets system..."),await be.init(),this.isInitialized=!0,console.log("‚úÖ PixiJS Assets initialized"))}async loadPreloadAssets(){await this.initAssets(),console.log("üì¶ Loading preload assets...");const e=[{alias:"logo",src:ji.logo},{alias:"loader",src:ji.loader},{alias:"loaderBg",src:ji.loaderBg}];for(const t of e)be.add(t);await be.load(e.map(e=>e.alias),e=>{this.progress=.1*e,this.onProgressCallback?.(this.progress)}),console.log("‚úÖ Preload assets loaded")}async loadGameAssets(){await this.initAssets(),console.log("üì¶ Loading game assets...");const e=function(){const e=[];return Object.entries(Hi).forEach(([t,n])=>{const i=`${n.alias}_skeleton`,s=`${n.alias}_atlas`;e.push({alias:i,src:n.skeleton,data:{atlas:n.atlas}}),e.push({alias:s,src:n.atlas})}),Object.entries(Ui).forEach(([t,n])=>{e.push({alias:n.alias,src:n.src})}),Object.entries(ji).forEach(([t,n])=>{e.push({alias:t,src:n})}),e.push({alias:"sounds",src:qi.sounds}),e}();for(const t of e)be.add(t);await be.load(e.map(e=>e.alias),e=>{this.progress=.1+.9*e,this.onProgressCallback?.(this.progress)}),console.log("‚úÖ Game assets loaded")}async loadAll(){try{await this.loadPreloadAssets(),await this.loadGameAssets(),this.progress=1,this.onProgressCallback?.(this.progress)}catch(e){throw console.error("‚ùå Asset loading failed:",e),e}}get(e){return be.get(e)}has(e){try{return be.get(e),!0}catch{return!1}}async unload(e){await be.unload(e)}reset(){this.progress=0,this.onProgressCallback=null}};async function Xi(e,t,n){const i=(new DOMParser).parseFromString(e,"text/xml"),s=i.querySelector("info"),a=i.querySelector("common"),o=i.querySelectorAll("char");if(!s||!a||0===o.length)throw new Error("Invalid BMFont XML format");const l=parseInt(s.getAttribute("size")||"32");parseInt(a.getAttribute("lineHeight")||"32"),parseInt(a.getAttribute("base")||"32");const r={};o.forEach(e=>{const n=parseInt(e.getAttribute("id")||"0"),i=parseInt(e.getAttribute("x")||"0"),s=parseInt(e.getAttribute("y")||"0"),a=parseInt(e.getAttribute("width")||"0"),o=parseInt(e.getAttribute("height")||"0"),l=parseInt(e.getAttribute("xoffset")||"0"),h=parseInt(e.getAttribute("yoffset")||"0"),c=parseInt(e.getAttribute("xadvance")||"0");if(a>0&&o>0){const e=new ye({source:t.source,frame:{x:i,y:s,width:a,height:o}});r[String.fromCharCode(n)]={xOffset:l,yOffset:h,xAdvance:c,texture:e}}}),we.install({name:n,style:{fontFamily:n,fontSize:l},chars:r}),console.log(`‚úÖ Bitmap font "${n}" loaded with ${Object.keys(r).length} characters`)}const Yi={blue:{min:1,max:5},green:{min:6,max:10},pink:{min:11,max:15},gold:{min:11,max:50}};class Ji{constructor(e){ce(this,"scenes",new Map),ce(this,"currentScene",null),ce(this,"stage"),ce(this,"isTransitioning",!1),this.stage=e}registerScene(e,t){this.scenes.has(e)&&console.warn(`‚ö†Ô∏è Scene '${e}' already registered, replacing...`),this.scenes.set(e,t),console.log(`‚úÖ Scene registered: ${e}`)}unregisterScene(e){const t=this.scenes.get(e);t&&(this.currentScene===t&&(this.currentScene.exit(),this.stage.removeChild(this.currentScene),this.currentScene=null),this.scenes.delete(e),console.log(`‚úÖ Scene unregistered: ${e}`))}async transitionTo(e){if(this.isTransitioning)return void console.warn("‚ö†Ô∏è Scene transition already in progress");const t=this.scenes.get(e);if(t)if(this.currentScene!==t){this.isTransitioning=!0,console.log(`üé¨ Transitioning to scene: ${e}`);try{this.currentScene&&(console.log(`  Exiting scene: ${this.currentScene.getName()}`),this.currentScene.setActive(!1),await this.currentScene.exit(),this.stage.removeChild(this.currentScene)),console.log(`  Entering scene: ${e}`),this.currentScene=t,this.stage.addChild(this.currentScene),this.currentScene.setActive(!0),await this.currentScene.enter(),console.log(`‚úÖ Scene transition complete: ${e}`)}catch(n){throw console.error("‚ùå Scene transition failed:",n),n}finally{this.isTransitioning=!1}}else console.warn(`‚ö†Ô∏è Already in scene '${e}'`);else console.error(`‚ùå Scene '${e}' not found`)}update(e){this.currentScene&&this.currentScene.getIsActive()&&this.currentScene.update(e)}getCurrentScene(){return this.currentScene}getCurrentSceneName(){return this.currentScene?this.currentScene.getName():null}hasScene(e){return this.scenes.has(e)}getScene(e){return this.scenes.get(e)}getSceneNames(){return Array.from(this.scenes.keys())}destroy(){this.currentScene&&(this.currentScene.setActive(!1),this.currentScene.exit(),this.stage.removeChild(this.currentScene),this.currentScene=null),this.scenes.forEach(e=>{e.destroy()}),this.scenes.clear(),console.log("‚úÖ SceneManager destroyed")}}class Qi extends ge{constructor(e){super(),ce(this,"isActive",!1),ce(this,"sceneName"),this.sceneName=e}getName(){return this.sceneName}getIsActive(){return this.isActive}setActive(e){this.isActive=e}}class Zi extends Qi{constructor(e){super("intro"),ce(this,"spineManager"),ce(this,"continueButton",null),ce(this,"onContinueCallback",null),ce(this,"keyboardHandler",null),ce(this,"animationCompleteHandler",null),this.spineManager=e,this.isRenderGroup=!0}async enter(){console.log("üé¨ Entering intro scene..."),this.animationCompleteHandler=e=>{"splash_intro"===e.animation?.name&&(console.log("‚úÖ splash_intro animation completed"),this.showContinueButton())};const e=this.spineManager.reelhouseSpine;e&&e.state.addListener({complete:this.animationCompleteHandler}),this.spineManager.playBackgroundAnimation("idle",!0),this.spineManager.playReelhouseAnimation(0,"splash_intro",!1),this.spineManager.playReelhouseAnimation(1,"particles",!0),this.spineManager.debugReelhouseInfo();const t=$i.getCurrentAnimation(this.spineManager.reelhouseSpine,0);console.log("üé¨ Current animation on track 0:",t);const n=$i.listAnimations(this.spineManager.reelhouseSpine);console.log("üé¨ Available animations:",n),console.log("‚úÖ Intro scene entered")}update(e){}async exit(){console.log("üé¨ Exiting intro scene...");const e=this.spineManager.reelhouseSpine;e&&this.animationCompleteHandler&&(e.state.removeListener(this.animationCompleteHandler),this.animationCompleteHandler=null),this.hideContinueButton(),console.log("‚úÖ Intro scene exited")}setOnContinue(e){this.onContinueCallback=e}showContinueButton(){try{const e=be.get("continue");if(!e)return void console.warn("‚ö†Ô∏è Continue button texture not found");this.continueButton=new Se(e),this.continueButton.anchor.set(.5),this.continueButton.x=0,this.continueButton.y=700,this.continueButton.alpha=0,this.continueButton.scale.set(.72),this.continueButton.eventMode="static",this.continueButton.cursor="pointer",this.continueButton.on("pointerover",()=>{this.onButtonHover()}),this.continueButton.on("pointerout",()=>{this.onButtonOut()}),this.continueButton.on("pointerdown",()=>{this.onButtonClick()}),this.addChild(this.continueButton),this.enableFullscreenClick(),this.setupKeyboardHandler(),this.animateButtonIn(),console.log("‚úÖ Continue button shown")}catch(e){console.error("‚ùå Failed to show continue button:",e)}}setupKeyboardHandler(){this.keyboardHandler=e=>{this.continueButton&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.onButtonClick()))},window.addEventListener("keydown",this.keyboardHandler)}removeKeyboardHandler(){this.keyboardHandler&&(window.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null)}enableFullscreenClick(){this.eventMode="static",this.cursor="pointer",this.hitArea=new ve(-2e3,-2e3,4e3,4e3),this.on("pointerdown",e=>{console.log("üñ±Ô∏è Scene clicked at:",e.global.x,e.global.y),this.continueButton&&this.onButtonClick()}),console.log("‚úÖ Fullscreen click enabled - click anywhere to continue")}disableFullscreenClick(){this.eventMode="auto",this.cursor="default",this.hitArea=null,this.removeAllListeners("pointerdown"),console.log("‚úÖ Fullscreen click disabled")}animateButtonIn(){if(!this.continueButton)return;Oi.playClick();const e=Date.now(),t=()=>{if(!this.continueButton)return;const n=Date.now()-e,i=Math.min(n/500,1),s=1-Math.pow(1-i,3);this.continueButton.alpha=s,this.continueButton.scale.set(.72+.08*s),i<1&&requestAnimationFrame(t)};t()}onButtonHover(){if(!this.continueButton)return;const e=this.continueButton.scale.x,t=Date.now(),n=()=>{if(!this.continueButton)return;const i=Date.now()-t,s=Math.min(i/150,1),a=1-Math.pow(1-s,2),o=e+(.88-e)*a;this.continueButton.scale.set(o),s<1&&requestAnimationFrame(n)};n()}onButtonOut(){if(!this.continueButton)return;const e=this.continueButton.scale.x,t=Date.now(),n=()=>{if(!this.continueButton)return;const i=Date.now()-t,s=Math.min(i/150,1),a=1-Math.pow(1-s,2),o=e+(.8-e)*a;this.continueButton.scale.set(o),s<1&&requestAnimationFrame(n)};n()}onButtonClick(){if(!this.continueButton)return;console.log("üñ±Ô∏è Continue button clicked"),Oi.playClick();const e=this.continueButton.scale.x,t=Date.now(),n=()=>{if(!this.continueButton)return;const i=Date.now()-t,s=Math.min(i/100,1),a=e*(1-.1*s);this.continueButton.scale.set(a),s>=1?(this.hideContinueButton(),this.onContinueCallback&&this.onContinueCallback()):requestAnimationFrame(n)};n()}hideContinueButton(){this.continueButton&&(this.removeChild(this.continueButton),this.continueButton.destroy(),this.continueButton=null,this.removeKeyboardHandler(),this.disableFullscreenClick(),console.log("‚úÖ Continue button hidden"))}destroy(e){this.hideContinueButton(),this.onContinueCallback=null,super.destroy(e)}}const es={reels:5,rows:4,mask:{width:310,height:310,spacing:15.5},symbolStep:325.5,baseSymbolScale:.62,pivot:{x:775,y:655},startX:0,startY:0,verticalAdjustment:0,spinSpeed:50,stopDuration:500,bounceHeight:20,blurAmount:8,symbols:{high:["h1","h2","h3","h4","h5"],low:["l1","l2","l3","l4","l5"],special:["wild","scatter"]},symbolTextures:{h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",l1:"l1",l2:"l2",l3:"l3",l4:"l4",l5:"l5",wild:"wild",scatter:"bonus"},symbolSettings:{h1:{scale:.4,x:0,y:0},h2:{scale:.4,x:0,y:0},h3:{scale:.4,x:0,y:0},h4:{scale:.4,x:0,y:0},h5:{scale:.4,x:0,y:0},l1:{scale:.4,x:0,y:0},l2:{scale:.4,x:0,y:0},l3:{scale:.4,x:0,y:0},l4:{scale:.4,x:0,y:0},l5:{scale:.4,x:0,y:0},wild:{scale:.4,x:0,y:0},scatter:{scale:.4,x:0,y:0}},reelStrips:[["h1","l1","h2","l2","h3","l3","h4","l4","h5","l5","wild","scatter"],["h2","l2","h3","l3","h4","l4","h5","l5","h1","l1","wild","scatter"],["h3","l3","h4","l4","h5","l5","h1","l1","h2","l2","wild","scatter"],["h4","l4","h5","l5","h1","l1","h2","l2","h3","l3","wild","scatter"],["h5","l5","h1","l1","h2","l2","h3","l3","h4","l4","wild","scatter"]]},ts=["wild","scatter"];let ns=class extends ge{constructor(e){super(),ce(this,"symbolType"),ce(this,"isWinningSymbol",!1),ce(this,"spine"),ce(this,"isAnimating",!1),ce(this,"animationState","static"),this.symbolType=e;try{this.spine=Me.from({skeleton:"symbol_spine_skeleton",atlas:"symbol_spine_atlas"}),this.spine.autoUpdate=!1,this.applySymbolSettings(),this.playStaticAnimation(),this.addChild(this.spine)}catch(t){console.error(`‚ùå Failed to create Symbol ${e}:`,t)}}applySymbolSettings(){const e=es.symbolSettings[this.symbolType],t=es.baseSymbolScale*(e?.scale??1);this.spine.scale.set(t);const n=es.mask.width/2,i=es.mask.height/2;this.spine.x=n+(e?.x??0),this.spine.y=i+(e?.y??0)}playStaticAnimation(){const e=`${es.symbolTextures[this.symbolType]}_static`;try{this.spine.state.setAnimation(0,e,!1),this.spine.update(0),this.spine.autoUpdate=!1,this.isAnimating=!1}catch(t){try{const e=es.symbolTextures[this.symbolType];this.spine.state.setAnimation(0,e,!1),this.spine.update(0),this.spine.autoUpdate=!1,this.isAnimating=!1}catch(n){console.error(`‚ùå Failed to play animation for symbol: ${this.symbolType}`)}}}enableAnimation(){this.isAnimating||(this.spine.autoUpdate=!0,this.isAnimating=!0)}disableAnimation(){this.isAnimating&&(this.spine.autoUpdate=!1,this.isAnimating=!1)}getType(){return this.symbolType}setType(e){this.symbolType=e,this.applySymbolSettings(),this.playStaticAnimation()}isSpecialSymbol(){return ts.includes(this.symbolType)}playLandAnimation(){if(!this.isSpecialSymbol())return void this.playStaticAnimation();const e=`${es.symbolTextures[this.symbolType]}_land`;try{this.spine.state.setAnimation(0,e,!1),this.spine.alpha=1,this.enableAnimation(),this.animationState="land",this.spine.state.addListener({complete:()=>{this.playStaticAnimation(),this.spine.state.clearListeners()}})}catch(t){this.playStaticAnimation()}}reveal(){this.isSpecialSymbol()?this.playLandAnimation():this.playStaticAnimation()}setWinning(e){if(this.isWinningSymbol=e,e){const e=`${es.symbolTextures[this.symbolType]}_win`;try{this.spine.state.setAnimation(0,e,!0),this.spine.alpha=1,this.enableAnimation()}catch(t){this.playStaticAnimation(),this.spine.alpha=1}}else this.disableAnimation(),this.playStaticAnimation(),this.spine.alpha=.6}resetAppearance(){this.isWinningSymbol=!1,this.animationState="static",this.disableAnimation(),this.playStaticAnimation(),this.spine.alpha=1,this.tintWhite()}isWinning(){return this.isWinningSymbol}tintDark(){this.spine.tint=6710886}tintWhite(){this.spine.tint=16777215}setBlur(e){}getAnimationState(){return this.animationState}destroy(e){try{this.spine&&!this.spine.destroyed&&(this.removeChild(this.spine),this.spine.destroy())}catch(t){}super.destroy(e)}};class is{constructor(e){ce(this,"container"),ce(this,"maskContainer"),ce(this,"base"),ce(this,"reelMask"),ce(this,"symbols",[]),ce(this,"reelStrip"),ce(this,"currentPosition",0),ce(this,"isSpinning",!1),ce(this,"spinTimeline",null),ce(this,"debugGraphics",null),this.container=new ge;const t=es.mask.width,n=es.mask.height,i=es.mask.spacing,s=n*es.rows+i*(es.rows-1);this.reelMask=new ke,this.reelMask.rect(0,0,t,s),this.reelMask.fill({color:16777215}),this.container.addChild(this.reelMask),this.maskContainer=new ge,this.maskContainer.mask=this.reelMask,this.container.addChild(this.maskContainer),this.base=new ge,this.maskContainer.addChild(this.base),this.reelStrip=[...es.reelStrips[e]];const a=es.rows+3,o=es.symbolStep;for(let l=0;l<a;l++){const e=this.reelStrip[l%this.reelStrip.length],t=new ns(e);t.y=l*o,this.symbols.push(t),this.base.addChild(t)}console.log(`‚úÖ Reel ${e} created with mask (${t}x${s}px), symbolStep: ${o}`)}getSymbolAt(e){return this.symbols[e]??null}getVisibleSymbols(){return this.symbols.slice(0,es.rows)}async startSpin(){if(this.isSpinning)return;this.isSpinning=!0,this.symbols.forEach(e=>e.resetAppearance()),this.base.y=0,this.spinTimeline&&this.spinTimeline.kill(),this.spinTimeline=Ce.timeline();const e=Vi.turboMode,t=es.symbolStep;this.spinTimeline.to(this.base,{y:-25,duration:.1,ease:"power2.out"}),this.spinTimeline.to(this.base,{y:3*t,duration:.2,ease:"power2.in",onUpdate:()=>this.wrapSymbols()});const n=e?Ii.timing.turboDuration/1e3:Ii.timing.spinDuration/1e3;this.spinTimeline.to(this.base,{y:"+="+40*t,duration:n,ease:"none",onUpdate:()=>this.wrapSymbols()})}async stopSpin(e,t=!1){if(!this.isSpinning)return;this.spinTimeline&&(this.spinTimeline.kill(),this.spinTimeline=null);const n=es.symbolStep;for(let s=0;s<this.symbols.length;s++)this.symbols[s].y=s*n;for(let s=0;s<es.rows&&s<e.length;s++)this.symbols[s].setType(e[s]);const i=Ce.timeline();t?(i.to(this.base,{y:.6*n,duration:.5,ease:"power3.out"}),i.to({},{duration:Ii.timing.anticipationDelay/1e3}),i.to(this.base,{y:-15,duration:.15,ease:"power2.in"}),i.to(this.base,{y:0,duration:.25,ease:"bounce.out",onComplete:()=>{this.revealSymbols()}})):(i.to(this.base,{y:.4*n,duration:.15,ease:"power2.out"}),i.to(this.base,{y:-18,duration:.12,ease:"power2.in"}),i.to(this.base,{y:0,duration:.2,ease:"back.out(3)",onComplete:()=>{this.isSpinning=!1,this.base.y=0;for(let e=0;e<this.symbols.length;e++)this.symbols[e].y=e*n;this.revealSymbols()}})),await i.then(),this.isSpinning=!1}wrapSymbols(){const e=es.symbolStep,t=e*(es.rows+1),n=[...this.symbols].sort((e,t)=>e.y-t.y)[0];this.symbols.forEach(i=>{this.base.y+i.y>t&&(i.y=n.y-e,this.currentPosition=(this.currentPosition+1)%this.reelStrip.length,i.setType(this.reelStrip[this.currentPosition]))})}setStatic(e){for(let t=0;t<es.rows&&t<e.length;t++)this.symbols[t].setType(e[t]);this.base.y=0,this.isSpinning=!1}highlightWinningSymbols(e){this.symbols.forEach((t,n)=>{n<es.rows&&t.setWinning(e.includes(n))})}resetSymbols(){this.symbols.forEach(e=>e.resetAppearance())}tintDarkSymbols(){this.symbols.forEach(e=>e.tintDark())}tintWhiteSymbols(){this.symbols.forEach(e=>e.tintWhite())}revealSymbols(){this.symbols.forEach((e,t)=>{t<es.rows&&e.reveal()})}getIsSpinning(){return this.isSpinning}enableDebug(){this.debugGraphics||(this.debugGraphics=new ke,this.container.addChild(this.debugGraphics)),this.updateDebugVisualization()}disableDebug(){this.debugGraphics&&(this.container.removeChild(this.debugGraphics),this.debugGraphics.destroy(),this.debugGraphics=null)}updateDebugVisualization(){if(!this.debugGraphics)return;this.debugGraphics.clear();const e=es.mask.width,t=es.mask.height,n=t*es.rows+es.mask.spacing*(es.rows-1);this.debugGraphics.rect(0,0,e,n),this.debugGraphics.stroke({width:2,color:16711680,alpha:.8}),this.symbols.forEach((n,i)=>{const s=i<es.rows?65280:16776960;this.debugGraphics.rect(0,n.y,e,t),this.debugGraphics.stroke({width:1,color:s,alpha:.6});const a=new _e({text:`${i}: Y=${n.y.toFixed(0)}`,style:{fontSize:12,fill:16777215}});a.x=5,a.y=n.y+5,this.debugGraphics.addChild(a)}),this.debugGraphics.moveTo(0,n/2),this.debugGraphics.lineTo(e,n/2),this.debugGraphics.stroke({width:1,color:65535,alpha:.5})}destroy(e){try{this.spinTimeline&&(this.spinTimeline.kill(),this.spinTimeline=null),this.debugGraphics&&(this.debugGraphics.destroy(),this.debugGraphics=null),this.symbols.forEach(e=>{try{e.destroy()}catch(t){}}),this.symbols=[];try{this.reelMask?.destroy()}catch(t){}try{this.base?.destroy()}catch(t){}try{this.maskContainer?.destroy()}catch(t){}try{this.container?.destroy()}catch(t){}}catch(t){console.warn("Reel destroy error:",t)}}}const ss=[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[0,0,1,2,2],[2,2,1,0,0],[1,0,0,0,1],[1,2,2,2,1],[0,1,1,1,0]],as=[16739179,5164484,16770669,9822675,15958401,11179738,16564041,3065014,15223391,11069135];class os extends ge{constructor(){super(),ce(this,"lineGraphics"),ce(this,"activeTimelines",[]),this.lineGraphics=new ke,this.addChild(this.lineGraphics),this.label="WinLineDisplay"}async showWinLine(e,t=0){const n=as[t%as.length],i=e.positions;if(i.length<2)return;const s=i.map(e=>this.getSymbolCenter(e.reel,e.row));await this.animateLine(s,n,t)}async showWinLines(e,t=800){for(let n=0;n<e.length;n++)await this.showWinLine(e[n],n),n<e.length-1&&(await this.delay(t),this.clearLines())}async animateLine(e,t,n){const i=Ce.timeline();this.activeTimelines.push(i);const s=new ge,a=new ke;s.addChild(a),this.addChild(s);const o=new ke;s.addChildAt(o,0);const l={value:0};i.to(l,{value:1,duration:.3,ease:"power2.out",onUpdate:()=>{this.drawPartialLine(a,e,l.value,t,6),this.drawPartialLine(o,e,l.value,t,12,.3)}}),i.to(s,{alpha:.7,duration:.15,yoyo:!0,repeat:3,ease:"power1.inOut"},"+=0.1"),i.to(s,{alpha:0,duration:.3,onComplete:()=>{s.destroy()}},"+=0.5"),await i.then()}drawPartialLine(e,t,n,i,s,a=1){if(e.clear(),t.length<2||n<=0)return;const o=t.length-1,l=n*o,r=Math.floor(l),h=l-r;e.moveTo(t[0].x,t[0].y);for(let c=0;c<r&&c<o;c++)e.lineTo(t[c+1].x,t[c+1].y);if(r<o&&h>0){const n=t[r],i=t[r+1],s=n.x+(i.x-n.x)*h,a=n.y+(i.y-n.y)*h;e.lineTo(s,a)}e.stroke({width:s,color:i,alpha:a,cap:"round",join:"round"})}getSymbolCenter(e,t){const n=es.mask.width,i=es.symbolStep;return{x:e*(n+2)+n/2,y:t*i+i/2}}clearLines(){this.activeTimelines.forEach(e=>e.kill()),this.activeTimelines=[],this.lineGraphics.clear(),this.children.forEach(e=>{e!==this.lineGraphics&&e.destroy()})}static getPayline(e){return ss[e%ss.length]}static getAllPaylines(){return ss}delay(e){return new Promise(t=>setTimeout(t,e))}destroy(e){this.clearLines(),super.destroy(e)}}class ls extends ge{constructor(){super(),ce(this,"reels",[]),ce(this,"winLineDisplay"),this.visible=!1,this.alpha=0,console.log("üé∞ Initializing ReelSystem..."),console.log(`  Config: ${es.reels} reels, ${es.rows} rows`),console.log(`  Mask size: ${es.mask.width}x${es.mask.height}`),console.log(`  Symbol step: ${es.symbolStep}`),this.pivot.x=es.pivot.x,this.pivot.y=es.pivot.y,console.log(`  Pivot: (${es.pivot.x}, ${es.pivot.y})`),console.log(`  Position offset: (${es.startX}, ${es.startY})`);const e=es.mask.width;for(let t=0;t<es.reels;t++){const n=new is(t),i=t*(e+2),s=0;n.container.x=i,n.container.y=s,console.log(`  Reel ${t} positioned at: (${i.toFixed(1)}, ${s.toFixed(1)})`),this.reels.push(n),this.addChild(n.container)}this.winLineDisplay=new os,this.addChild(this.winLineDisplay),console.log("‚úÖ ReelSystem initialized")}async prespinReels(){console.log("üé∞ Pre-spinning reels...");const e=Vi.turboMode,t=e?0:60;for(let n=0;n<this.reels.length;n++)this.reels[n].startSpin(),!e&&n<this.reels.length-1&&await zi(t)}async revealReels(e,t,n=!1){console.log("üéØ Revealing reels...",e);const i=Vi.turboMode?50:180;for(let s=0;s<this.reels.length;s++){const n=this.reels[s],a=e.symbols[s],o=t?.reels.includes(s)??!1;await n.stopSpin(a,o);for(let e=0;e<a.length;e++)await Di.emit({type:"symbolLand",symbol:a[e],reelIndex:s,rowIndex:e}),await zi(Ii.timing.symbolLandDelay);await Di.emit({type:"reelStop",reelIndex:s}),s<this.reels.length-1&&await zi(i)}console.log("‚úÖ Reels revealed")}setStatic(e){for(let t=0;t<this.reels.length&&t<e.length;t++)this.reels[t].setStatic(e[t])}highlightWins(e){if(this.tintWhiteAllSymbols(),!e.wins||0===e.wins.length)return;const t=new Map;for(const n of e.wins)for(const e of n.positions)t.has(e.reel)||t.set(e.reel,new Set),t.get(e.reel).add(e.row);for(let n=0;n<this.reels.length;n++){const e=Array.from(t.get(n)??[]);this.reels[n].highlightWinningSymbols(e)}}async animateBoardWins(e){if(!e.wins||0===e.wins.length)return;const t=Vi.turboMode,n=t?400:800,i=t?50:100,s=es.symbols.high;for(let a=0;a<e.wins.length;a++){const t=e.wins[a];this.tintDarkAllSymbols();for(const e of t.positions){const t=this.reels[e.reel];t&&t.highlightWinningSymbols([e.row]),await zi(i)}const o=s.includes(t.symbol);Di.emit({type:"symbolWin",symbol:t.symbol,isHighSymbol:o}),await this.winLineDisplay.showWinLine(t,a),a<e.wins.length-1&&await zi(n)}this.winLineDisplay.clearLines(),this.tintWhiteAllSymbols()}async showWinLine(e,t=0){await this.winLineDisplay.showWinLine(e,t)}clearWinLines(){this.winLineDisplay.clearLines()}tintDarkAllSymbols(){this.reels.forEach(e=>e.tintDarkSymbols())}tintWhiteAllSymbols(){this.reels.forEach(e=>e.resetSymbols())}isSpinning(){return this.reels.some(e=>e.getIsSpinning())}getSymbolAt(e,t){if(e<0||e>=this.reels.length)return null;const n=this.reels[e].getSymbolAt(t);return n?n.getType():null}getCurrentBoard(){const e=[];for(const t of this.reels){const n=t.getVisibleSymbols();e.push(n.map(e=>e.getType()))}return e}enableDebug(){console.log("üîç Enabling debug visualization on all reels..."),this.reels.forEach((e,t)=>{e.enableDebug(),console.log(`  ‚úÖ Debug enabled on reel ${t}`)})}disableDebug(){console.log("üîç Disabling debug visualization on all reels..."),this.reels.forEach(e=>e.disableDebug())}destroy(e){this.reels.forEach(e=>e.destroy()),this.reels=[],super.destroy(e)}}class rs extends Qi{constructor(e,t=null){super("gameplay"),ce(this,"spineManager"),ce(this,"reelSystem",null),ce(this,"reelSystemRef"),ce(this,"gameEnterCompleteHandler",null),ce(this,"isReelSystemAttached",!1),this.spineManager=e,this.reelSystemRef=t,this.isRenderGroup=!0}getReelSystem(){return this.reelSystem||(this.reelSystem=new ls),this.reelSystem}async enter(){console.log("üé¨ Entering gameplay scene...");const e=this.spineManager.reelhouseSpine;this.spineManager.playBackgroundAnimation("zoom_out",!1),this.spineManager.playReelhouseAnimation(0,"particles",!0),this.spineManager.playReelhouseAnimation(2,"game_enter",!1),e&&e.state.addAnimation(2,"idle",!0),this.spineManager.playReelhouseAnimation(4,"radish_idle",!0),console.log("‚úÖ Playing: particles(0), game_enter‚Üíidle(2), radish_idle(4)"),setTimeout(()=>{Oi.startBGM(),Oi.playGameEnter()},500),this.reelSystem||(console.log("üé∞ Creating ReelSystem lazily..."),this.reelSystem=new ls,null===this.reelSystemRef&&(this.reelSystemRef=this.reelSystem)),this.gameEnterCompleteHandler={complete:t=>{"game_enter"===t.animation?.name&&(console.log("‚úÖ game_enter completed, ensuring reels visible"),this.reelSystem&&(this.reelSystem.visible=!0,this.reelSystem.alpha=1),e&&this.gameEnterCompleteHandler&&(e.state.removeListener(this.gameEnterCompleteHandler),this.gameEnterCompleteHandler=null))}},e&&e.state.addListener(this.gameEnterCompleteHandler),e&&!this.isReelSystemAttached&&this.reelSystem&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!this.isReelSystemAttached&&this.reelSystem&&e)try{e.addSlotObject("slot_symbols",this.reelSystem),this.isReelSystemAttached=!0,console.log("‚úÖ ReelSystem attached to slot_symbols (delayed)")}catch(t){console.warn("‚ö†Ô∏è slot_symbols not found, adding to scene:",t),this.addChild(this.reelSystem),this.reelSystem.visible=!0,this.reelSystem.alpha=1}})}),console.log("‚úÖ Gameplay scene entered")}update(e){}async exit(){console.log("üé¨ Exiting gameplay scene...");const e=this.spineManager.reelhouseSpine;if(e&&this.gameEnterCompleteHandler&&(e.state.removeListener(this.gameEnterCompleteHandler),this.gameEnterCompleteHandler=null),e&&this.isReelSystemAttached)try{e.removeSlotObject("slot_symbols"),this.isReelSystemAttached=!1}catch(t){console.warn("‚ö†Ô∏è Could not detach from slot_symbols:",t)}this.reelSystem&&this.children.includes(this.reelSystem)&&this.removeChild(this.reelSystem),console.log("‚úÖ Gameplay scene exited")}destroy(e){super.destroy(e)}}class hs extends ge{constructor(){super(),ce(this,"overlay",null),ce(this,"gachaMachine",null),ce(this,"ball",null),ce(this,"multiplierText",null),ce(this,"instructionText",null),ce(this,"resultPanel",null),ce(this,"isRevealing",!1),ce(this,"revealPromise",null),ce(this,"resolveReveal",null),ce(this,"predeterminedColor",null),ce(this,"predeterminedMultiplier",null),ce(this,"predeterminedFreeSpins",null),ce(this,"ballColors",{blue:3900150,green:2278750,pink:15485081,gold:16096779}),ce(this,"titleStyle"),ce(this,"instructionStyle"),ce(this,"resultStyle"),this.label="GachaReveal",this.visible=!1,this.titleStyle=new xe({fontFamily:"Outfit, sans-serif",fontSize:48,fontWeight:"800",fill:16766720,dropShadow:{color:0,blur:6,distance:3,alpha:1}}),this.instructionStyle=new xe({fontFamily:"Outfit, sans-serif",fontSize:24,fontWeight:"500",fill:16777215}),this.resultStyle=new xe({fontFamily:"Outfit, sans-serif",fontSize:36,fontWeight:"700",fill:16777215,dropShadow:{color:0,blur:4,distance:2,alpha:1}})}async init(){console.log("üé∞ Initializing GachaReveal..."),this.createOverlay(),this.createGachaMachine(),this.createResultPanel(),console.log("‚úÖ GachaReveal initialized")}createOverlay(){this.overlay=new ke,this.overlay.rect(-1e3,-600,2e3,1200),this.overlay.fill({color:0,alpha:.7}),this.addChild(this.overlay)}createGachaMachine(){this.gachaMachine=new ge,this.gachaMachine.label="GachaMachine";const e=new ke;e.roundRect(-150,-200,300,350,20),e.fill({color:2956110}),e.stroke({color:7020968,width:4}),this.gachaMachine.addChild(e);const t=new ke;t.ellipse(0,-100,120,80),t.fill({color:4988309,alpha:.5}),t.stroke({color:8141549,width:3}),this.gachaMachine.addChild(t);const n=new _e({text:"BONUS!",style:this.titleStyle});n.anchor.set(.5,.5),n.y=-280,this.gachaMachine.addChild(n),this.instructionText=new _e({text:"TAP TO REVEAL",style:this.instructionStyle}),this.instructionText.anchor.set(.5,.5),this.instructionText.y=200,this.gachaMachine.addChild(this.instructionText),Ce.to(this.instructionText,{alpha:.5,duration:.8,yoyo:!0,repeat:-1,ease:"power2.inOut"}),this.ball=this.createBall("blue"),this.ball.y=-80,this.ball.visible=!1,this.gachaMachine.addChild(this.ball),this.gachaMachine.eventMode="static",this.gachaMachine.cursor="pointer",this.gachaMachine.on("pointerdown",()=>this.onMachineClick()),this.addChild(this.gachaMachine)}createBall(e){const t=new ge;t.label=`Ball_${e}`;const n=new ke;n.circle(0,0,60),n.fill({color:this.ballColors[e]}),n.stroke({color:16777215,width:3}),t.addChild(n);const i=new ke;return i.circle(-20,-20,15),i.fill({color:16777215,alpha:.4}),t.addChild(i),this.multiplierText=new _e({text:"",style:{...this.resultStyle,fontSize:32}}),this.multiplierText.anchor.set(.5,.5),t.addChild(this.multiplierText),t}createResultPanel(){this.resultPanel=new ge,this.resultPanel.label="ResultPanel",this.resultPanel.visible=!1;const e=new ke;e.roundRect(-200,-80,400,160,15),e.fill({color:1973067,alpha:.95}),e.stroke({color:6514417,width:3}),this.resultPanel.addChild(e);const t=new _e({text:"",style:this.resultStyle});t.anchor.set(.5,.5),t.name="resultText",this.resultPanel.addChild(t),this.resultPanel.y=300,this.addChild(this.resultPanel)}async onMachineClick(){if(this.isRevealing)return;this.isRevealing=!0,this.instructionText&&(Ce.killTweensOf(this.instructionText),Ce.to(this.instructionText,{alpha:0,duration:.2})),Oi.playGachaReveal();const e=this.predeterminedColor||this.getRandomBallColor(),t=this.predeterminedMultiplier||function(e){const t=Yi[e];return Math.floor(Math.random()*(t.max-t.min+1))+t.min}(e),n=this.predeterminedFreeSpins||this.getFreeSpinsForColor(e);await this.animateReveal(e,t,n),this.showResult(e,t,n),await this.delay(2e3),this.resolveReveal&&this.resolveReveal({ballColor:e,multiplier:t,freeSpins:n})}async animateReveal(e,t,n){if(!this.ball||!this.gachaMachine)return;const i=this.ball.getChildAt(0);i.clear(),i.circle(0,0,60),i.fill({color:this.ballColors[e]}),i.stroke({color:16777215,width:3}),this.multiplierText&&(this.multiplierText.text=`x${t}`),this.ball.visible=!0,this.ball.scale.set(0),this.ball.alpha=0,await Ce.to(this.gachaMachine,{x:"+=10",duration:.05,yoyo:!0,repeat:10,ease:"power2.inOut"}),Oi.playGachaBallReveal(e),await Ce.to(this.ball.scale,{x:1.2,y:1.2,duration:.3,ease:"back.out"}),Ce.to(this.ball,{alpha:1,duration:.2}),await Ce.to(this.ball.scale,{x:1,y:1,duration:.2,ease:"power2.out"}),await Ce.to(this.ball,{y:-60,duration:.3,yoyo:!0,repeat:2,ease:"power2.out"})}showResult(e,t,n){if(!this.resultPanel)return;Oi.playGachaWin();const i=this.resultPanel.getChildByName("resultText");i&&(i.text=`${n} FREE SPINS\nx${t} MULTIPLIER`,i.style.fill=this.ballColors[e]),this.resultPanel.visible=!0,this.resultPanel.scale.set(0),Ce.to(this.resultPanel.scale,{x:1,y:1,duration:.4,ease:"back.out"})}getRandomBallColor(){const e=Math.random();return e<.4?"blue":e<.7?"green":e<.9?"pink":"gold"}getFreeSpinsForColor(e){return{blue:8,green:10,pink:12,gold:15}[e]}async show(e,t,n){return console.log("üé∞ Showing gacha reveal..."),this.predeterminedColor=e||null,this.predeterminedMultiplier=t||null,this.predeterminedFreeSpins=n||null,this.isRevealing=!1,this.ball&&(this.ball.visible=!1),this.resultPanel&&(this.resultPanel.visible=!1),this.instructionText&&(this.instructionText.alpha=1,Ce.to(this.instructionText,{alpha:.5,duration:.8,yoyo:!0,repeat:-1,ease:"power2.inOut"})),this.visible=!0,this.alpha=0,await Ce.to(this,{alpha:1,duration:.3}),this.revealPromise=new Promise(e=>{this.resolveReveal=e}),this.revealPromise}async hide(){await Ce.to(this,{alpha:0,duration:.3}),this.visible=!1,this.isRevealing=!1,this.resolveReveal=null,this.revealPromise=null}delay(e){return new Promise(t=>setTimeout(t,e))}destroy(e){Ce.killTweensOf(this),Ce.killTweensOf(this.instructionText),Ce.killTweensOf(this.ball),Ce.killTweensOf(this.gachaMachine),Ce.killTweensOf(this.resultPanel),super.destroy(e)}}class cs extends Qi{constructor(e){super("bonus"),ce(this,"spineManager"),ce(this,"gachaReveal",null),ce(this,"totalMultiplier",1),ce(this,"accumulatedWin",0),ce(this,"scatterCount",3),this.spineManager=e,this.isRenderGroup=!0}async enter(){console.log("üé∞ Entering bonus scene..."),this.totalMultiplier=1,this.accumulatedWin=0,this.spineManager.enterBonusMode();const e=this.scatterCount>=5?"epic":this.scatterCount>=4?"super":"bonus";Oi.playBonusIntro(e,!0),this.gachaReveal||(this.gachaReveal=new hs,await this.gachaReveal.init(),this.addChild(this.gachaReveal));const t=await this.showGachaReveal();await this.processGachaResult(t),console.log("‚úÖ Bonus scene entered")}async showGachaReveal(){if(!this.gachaReveal)return{ballColor:"blue",multiplier:1,freeSpins:10};let e;this.scatterCount>=4&&(e=Math.random()<.5?"pink":"gold");const t=await this.gachaReveal.show(e);return await this.gachaReveal.hide(),t}async processGachaResult(e){console.log(`üé± Gacha result: ${e.ballColor} ball, x${e.multiplier}, ${e.freeSpins} free spins`),this.totalMultiplier=e.multiplier,Vi.startFreeSpins(e.freeSpins),await Di.emit({type:"bonusReveal",ballColor:e.ballColor,freeSpins:e.freeSpins})}addWin(e){this.accumulatedWin+=e}applyGachaMultiplier(e){this.totalMultiplier+=e,Oi.playGlobalMultUpdate(),console.log(`üé∞ Gacha multiplier added: +${e}, total: x${this.totalMultiplier}`)}getFinalWin(){return this.accumulatedWin*this.totalMultiplier}setScatterCount(e){this.scatterCount=e}update(e){}async exit(){console.log("üé∞ Exiting bonus scene...");const e=this.getFinalWin();console.log(`üí∞ Bonus complete! Accumulated: $${this.accumulatedWin}, Multiplier: x${this.totalMultiplier}, Final: $${e}`),this.spineManager.exitBonusMode();const t=this.scatterCount>=5?"epic":this.scatterCount>=4?"super":"bonus";Oi.playBonusOutro(t,!0),await Di.emit({type:"bonusExit"}),console.log("‚úÖ Bonus scene exited")}destroy(e){this.gachaReveal&&(this.gachaReveal.destroy(),this.gachaReveal=null),super.destroy(e)}}const us=593166,ds=987152,ps=16777215,ms=0,fs=52479;class gs extends ge{constructor(){super(),ce(this,"bottomPanel",null),ce(this,"balancePanel",null),ce(this,"betPanel",null),ce(this,"winPanel",null),ce(this,"freeSpinsPanel",null),ce(this,"balanceText",null),ce(this,"betText",null),ce(this,"winText",null),ce(this,"winValueText",null),ce(this,"freeSpinsText",null),ce(this,"spinButton",null),ce(this,"betPlusButton",null),ce(this,"betMinusButton",null),ce(this,"betModeBadges",new Map),ce(this,"currentBadge",null),ce(this,"onSpinCallback",null),ce(this,"isVisible",!1),ce(this,"labelStyle"),ce(this,"valueStyle"),ce(this,"winLabelStyle"),ce(this,"winValueStyle"),this.label="GameUI",this.visible=!1,this.labelStyle=new xe({fontFamily:"Outfit, sans-serif",fontSize:14,fontWeight:"500",fill:fs}),this.valueStyle=new xe({fontFamily:"Outfit, sans-serif",fontSize:22,fontWeight:"700",fill:ps}),this.winLabelStyle=new xe({fontFamily:"Outfit, sans-serif",fontSize:18,fontWeight:"700",fill:fs}),this.winValueStyle=new xe({fontFamily:"Outfit, sans-serif",fontSize:26,fontWeight:"700",fill:ms})}async init(){console.log("üé® Initializing GameUI..."),this.createBottomPanel(),this.createWinDisplay(),this.createFreeSpinsCounter(),await this.loadBetModeBadges(),this.setupEventListeners(),this.updateUI(),console.log("‚úÖ GameUI initialized")}createBottomPanel(){this.bottomPanel=new ge,this.bottomPanel.label="BottomPanel";const e=new ke;e.roundRect(-450,-50,900,100,16),e.fill({color:us,alpha:.9}),e.stroke({color:1710638,width:2}),this.bottomPanel.addChild(e),this.balancePanel=new ge,this.balancePanel.x=-340;const t=new _e({text:"BALANCE",style:this.labelStyle});t.anchor.set(.5,1),t.y=-5,this.balancePanel.addChild(t),this.balanceText=new _e({text:"1,000.00",style:this.valueStyle}),this.balanceText.anchor.set(.5,0),this.balanceText.y=2,this.balancePanel.addChild(this.balanceText),this.bottomPanel.addChild(this.balancePanel),this.betPanel=new ge,this.betPanel.x=0;const n=new _e({text:"BET",style:this.labelStyle});n.anchor.set(.5,1),n.y=-5,this.betPanel.addChild(n);const i=new ke;i.roundRect(-70,-2,140,44,10),i.fill({color:ds,alpha:.95}),this.betPanel.addChild(i),this.betText=new _e({text:"1.00",style:this.valueStyle}),this.betText.anchor.set(.5,.5),this.betText.y=18,this.betPanel.addChild(this.betText),this.betMinusButton=this.createBetButton("‚àí",-105,()=>{Vi.setBetAmount(Math.max(.1,Vi.betAmount-.5)),this.updateUI()}),this.betPanel.addChild(this.betMinusButton),this.betPlusButton=this.createBetButton("+",105,()=>{Vi.setBetAmount(Vi.betAmount+.5),this.updateUI()}),this.betPanel.addChild(this.betPlusButton),this.bottomPanel.addChild(this.betPanel),this.createSpinButton(),this.spinButton.x=340,this.bottomPanel.addChild(this.spinButton),this.bottomPanel.y=0,this.addChild(this.bottomPanel)}createBetButton(e,t,n){const i=new ge;i.x=t,i.y=18;const s=new ke;s.circle(0,0,22),s.fill({color:ds,alpha:.9}),s.stroke({color:fs,width:2,alpha:.5}),i.addChild(s);const a=new _e({text:e,style:{fontFamily:"Outfit, sans-serif",fontSize:26,fontWeight:"700",fill:ps}});return a.anchor.set(.5,.5),i.addChild(a),i.eventMode="static",i.cursor="pointer",i.on("pointerover",()=>{a.style.fill=fs,Ce.to(i.scale,{x:1.1,y:1.1,duration:.1})}),i.on("pointerout",()=>{a.style.fill=ps,Ce.to(i.scale,{x:1,y:1,duration:.1})}),i.on("pointerdown",()=>{Ce.to(i.scale,{x:.9,y:.9,duration:.05})}),i.on("pointerup",()=>{Ce.to(i.scale,{x:1.1,y:1.1,duration:.05}),n()}),i.on("pointerupoutside",()=>{Ce.to(i.scale,{x:1,y:1,duration:.05})}),i}createSpinButton(){this.spinButton=new ge,this.spinButton.label="SpinButton";const e=new ke;e.circle(0,0,58),e.fill({color:fs,alpha:.2}),this.spinButton.addChild(e);const t=new ke;t.circle(0,0,52),t.fill({color:ms}),this.spinButton.addChild(t);const n=new ke;n.circle(0,0,46),n.fill({color:ps}),n.label="spinBg",this.spinButton.addChild(n);const i=new ke;i.moveTo(-10,-16),i.lineTo(-10,16),i.lineTo(16,0),i.closePath(),i.fill({color:ms}),i.x=2,i.label="playIcon",this.spinButton.addChild(i),this.spinButton.eventMode="static",this.spinButton.cursor="pointer",this.spinButton.on("pointerdown",()=>{Vi.canSpin&&!Vi.isSpinning&&Ce.to(this.spinButton.scale,{x:.92,y:.92,duration:.08})}),this.spinButton.on("pointerup",()=>{Ce.to(this.spinButton.scale,{x:1,y:1,duration:.1}),this.onSpinCallback&&Vi.canSpin&&!Vi.isSpinning&&this.onSpinCallback()}),this.spinButton.on("pointerupoutside",()=>{Ce.to(this.spinButton.scale,{x:1,y:1,duration:.1})}),this.spinButton.on("pointerover",()=>{Vi.canSpin&&!Vi.isSpinning&&Ce.to(e,{alpha:.4,duration:.2})}),this.spinButton.on("pointerout",()=>{Ce.to(e,{alpha:.2,duration:.2})})}createWinDisplay(){this.winPanel=new ge,this.winPanel.label="WinPanel",this.winPanel.visible=!1;const e=new ke;e.roundRect(-120,-40,240,80,14),e.fill({color:ps}),e.stroke({color:ms,width:3}),this.winPanel.addChild(e),this.winText=new _e({text:"WIN",style:this.winLabelStyle}),this.winText.anchor.set(.5,1),this.winText.y=-5,this.winPanel.addChild(this.winText),this.winValueText=new _e({text:"0.00",style:this.winValueStyle}),this.winValueText.anchor.set(.5,0),this.winValueText.y=2,this.winPanel.addChild(this.winValueText),this.winPanel.y=-500,this.addChild(this.winPanel)}createFreeSpinsCounter(){this.freeSpinsPanel=new ge,this.freeSpinsPanel.label="FreeSpinsPanel",this.freeSpinsPanel.visible=!1;const e=new ke;e.roundRect(-90,-35,180,70,14),e.fill({color:us,alpha:.95}),e.stroke({color:fs,width:2}),this.freeSpinsPanel.addChild(e);const t=new _e({text:"FREE SPINS",style:{...this.labelStyle,fontSize:13}});t.anchor.set(.5,1),t.y=-5,this.freeSpinsPanel.addChild(t),this.freeSpinsText=new _e({text:"0",style:{...this.valueStyle,fontSize:28}}),this.freeSpinsText.anchor.set(.5,0),this.freeSpinsText.y=2,this.freeSpinsPanel.addChild(this.freeSpinsText),this.freeSpinsPanel.x=380,this.freeSpinsPanel.y=-500,this.addChild(this.freeSpinsPanel)}async loadBetModeBadges(){const e=["ANTE","BONUS","SUPER","EPIC"];for(const n of e){if(Ii.betModes[n].badge)try{const e=be.get(n.toLowerCase()+"Badge");if(e){const t=new Se(e);t.anchor.set(.5,.5),t.scale.set(.4),t.visible=!1,t.x=-200,t.y=420,this.addChild(t),this.betModeBadges.set(n,t)}}catch(t){console.warn(`‚ö†Ô∏è Could not load badge for ${n}`)}}}setupEventListeners(){Di.on("balanceUpdate",()=>this.updateUI()),Di.on("winPresent",e=>{"winPresent"===e.type&&this.showWin(e.amount)}),Di.on("spinStart",()=>this.setSpinning(!0)),Di.on("spinEnd",()=>this.setSpinning(!1))}setOnSpin(e){this.onSpinCallback=e}show(){if(!this.isVisible){if(this.isVisible=!0,this.visible=!0,this.alpha=0,Ce.to(this,{alpha:1,duration:.5,ease:"power2.out"}),this.spinButton&&(this.spinButton.scale.set(0),this.spinButton.alpha=0,Ce.to(this.spinButton,{alpha:1,duration:.4,delay:.3,ease:"power2.out"}),Ce.to(this.spinButton.scale,{x:1,y:1,duration:.5,delay:.3,ease:"back.out(1.7)"})),this.bottomPanel){const e=this.bottomPanel.y;this.bottomPanel.y=e+100,this.bottomPanel.alpha=0,Ce.to(this.bottomPanel,{y:e,alpha:1,duration:.5,delay:.2,ease:"power3.out"})}this.betModeBadges.forEach((e,t)=>{e.visible&&(e.scale.set(0),Ce.to(e.scale,{x:1,y:1,duration:.4,delay:.4,ease:"back.out(2)"}))}),this.updateUI()}}hide(){this.isVisible&&(this.isVisible=!1,Ce.to(this,{alpha:0,duration:.3,ease:"power2.in",onComplete:()=>{this.visible=!1}}))}pulseSpinButton(){this.spinButton&&Ce.to(this.spinButton.scale,{x:1.1,y:1.1,duration:.3,yoyo:!0,repeat:1,ease:"power2.inOut"})}animateSpinReady(){if(!this.spinButton)return;const e=this.spinButton.getChildAt(0);e&&Ce.to(e,{alpha:.5,duration:.5,yoyo:!0,repeat:-1,ease:"sine.inOut"})}stopSpinReadyAnimation(){if(!this.spinButton)return;const e=this.spinButton.getChildAt(0);e&&(Ce.killTweensOf(e),e.alpha=.2)}updateUI(){this.balanceText&&(this.balanceText.text=this.formatNumber(Vi.balance)),this.betText&&(this.betText.text=this.formatNumber(Vi.adjustedBetAmount)),this.freeSpinsText&&this.freeSpinsPanel&&(Vi.inFreeSpins?(this.freeSpinsPanel.visible=!0,this.freeSpinsText.text=`${Vi.freeSpinsRemaining}`):this.freeSpinsPanel.visible=!1),this.updateBetModeBadge(),this.updateSpinButton()}updateBetModeBadge(){if(this.currentBadge&&(this.currentBadge.visible=!1),"BASE"!==Vi.betMode){const e=this.betModeBadges.get(Vi.betMode);e&&(e.visible=!0,this.currentBadge=e)}}updateSpinButton(){if(!this.spinButton)return;Vi.canSpin&&!Vi.isSpinning&&Vi.canAffordBet?(this.spinButton.alpha=1,this.spinButton.cursor="pointer"):(this.spinButton.alpha=.5,this.spinButton.cursor="not-allowed")}setSpinning(e){if(!this.spinButton)return;const t=this.spinButton.getChildByLabel("playIcon");e?(t&&(t.visible=!1),Ce.to(this.spinButton,{rotation:4*Math.PI,duration:2,repeat:-1,ease:"linear"})):(t&&(t.visible=!0),Ce.killTweensOf(this.spinButton),this.spinButton.rotation=0),this.updateSpinButton()}showWin(e){this.winPanel&&this.winValueText&&(this.winValueText.text=this.formatNumber(e),this.winPanel.visible=!0,this.winPanel.scale.set(0),this.winPanel.alpha=0,Ce.to(this.winPanel.scale,{x:1,y:1,duration:.4,ease:"back.out(1.7)"}),Ce.to(this.winPanel,{alpha:1,duration:.3}),Ce.to(this.winValueText.scale,{x:1.15,y:1.15,duration:.25,yoyo:!0,repeat:3,ease:"power2.inOut"}),Ce.delayedCall(3,()=>{Ce.to(this.winPanel,{alpha:0,duration:.3,onComplete:()=>{this.winPanel.visible=!1}})}))}formatNumber(e){return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}destroy(e){Ce.killTweensOf(this.spinButton),Ce.killTweensOf(this.winPanel),Ce.killTweensOf(this.winValueText),Ce.killTweensOf(this),super.destroy(e)}}const bs=1920,ys=1080;class ws{constructor(){ce(this,"app",null),ce(this,"stage",null),ce(this,"backgroundLayer",null),ce(this,"persistentLayer",null),ce(this,"transientLayer",null),ce(this,"uiLayer",null),ce(this,"reelSystem",null),ce(this,"spineManager",null),ce(this,"sceneManager",null),ce(this,"gameUI",null),ce(this,"isInitialized",!1),ce(this,"currentResponsiveScale",1)}async init(e){if(this.isInitialized)console.warn("‚ö†Ô∏è Game already initialized");else{console.log("üéÆ Initializing game..."),Vi.setState(Ii.states.LOADING);try{this.app=new Be,await this.app.init({resizeTo:window,background:Ii.backgroundColor,antialias:Ii.antialias,resolution:Math.min(2,window.devicePixelRatio||1),autoDensity:!0}),e.appendChild(this.app.canvas),this.stage=this.app.stage,await this.loadAssets(),await this.initSystems(),this.setupResizeHandler(),this.setupEventHandlers(),this.app.ticker.add(e=>this.update(e.deltaTime)),this.isInitialized=!0,Vi.setState(Ii.states.IDLE),console.log("‚úÖ Game initialized")}catch(t){throw console.error("‚ùå Game initialization failed:",t),Vi.setState(Ii.states.ERROR),t}}}async loadAssets(){console.log("üì¶ Loading assets..."),Ki.setProgressCallback(e=>{const t=100*e;console.log(`Loading: ${t.toFixed(0)}%`),Vi.setLoadingProgress(t)}),await Ki.loadAll(),await async function(){console.log("üî§ Loading bitmap fonts...");const e=[{name:"knb_blue",xmlPath:"/assets/sprites/knb_blue.xml",texturePath:"/assets/sprites/knb_blue.webp"},{name:"knb_pink",xmlPath:"/assets/sprites/knb_pink.xml",texturePath:"/assets/sprites/knb_pink.webp"}];for(const n of e)try{const e=await fetch(n.xmlPath),t=await e.text(),i=await be.load(n.texturePath);await Xi(t,i,n.name)}catch(t){console.error(`‚ùå Failed to load bitmap font ${n.name}:`,t)}console.log("‚úÖ Bitmap fonts loaded")}(),Vi.setLoadingProgress(100),console.log("‚úÖ Assets loaded")}async initSystems(){console.log("‚öôÔ∏è Initializing systems with layered architecture..."),this.spineManager=new Fi,await this.spineManager.init(),console.log("‚úÖ SpineManager initialized"),this.backgroundLayer=new ge,this.backgroundLayer.label="BackgroundLayer",this.backgroundLayer.isRenderGroup=!0,this.stage.addChild(this.backgroundLayer),this.spineManager.backgroundSpine&&(this.spineManager.removeChild(this.spineManager.backgroundSpine),this.backgroundLayer.addChild(this.spineManager.backgroundSpine)),console.log("‚úÖ Background layer created (cover mode)"),this.persistentLayer=new ge,this.persistentLayer.label="PersistentLayer",this.persistentLayer.isRenderGroup=!0,this.stage.addChild(this.persistentLayer),this.persistentLayer.addChild(this.spineManager),console.log("‚úÖ Persistent layer created (game scale)"),this.transientLayer=new ge,this.transientLayer.label="TransientLayer",this.stage.addChild(this.transientLayer),console.log("‚úÖ Transient layer created"),this.uiLayer=new ge,this.uiLayer.label="UILayer",this.stage.addChild(this.uiLayer),console.log("‚úÖ UI layer created"),this.reelSystem=null,await Oi.init(),this.gameUI=new gs,await this.gameUI.init(),this.gameUI.setOnSpin(()=>this.spin()),this.uiLayer.addChild(this.gameUI),console.log("‚úÖ GameUI initialized"),this.sceneManager=new Ji(this.transientLayer);const e=new Zi(this.spineManager),t=new rs(this.spineManager,null),n=new cs(this.spineManager);e.setOnContinue(()=>{this.transitionToGameplayScene(),this.gameUI?.show()}),this.sceneManager.registerScene("intro",e),this.sceneManager.registerScene("gameplay",t),this.sceneManager.registerScene("bonus",n),await this.sceneManager.transitionTo("intro"),console.log("‚úÖ Systems initialized with layered architecture")}setupEventHandlers(){Di.on("symbolLand",async e=>{"symbolLand"===e.type&&("wild"===e.symbol?Oi.playWildLand():"scatter"===e.symbol&&Oi.playBonusLand(Vi.turboMode))}),Di.on("reelStop",async e=>{"reelStop"===e.type&&Oi.playReelStop(e.reelIndex)}),Di.on("symbolWin",async e=>{"symbolWin"===e.type&&("scatter"===e.symbol?Oi.playBonusWin():"wild"===e.symbol?Oi.playSymbolWin(!0):Oi.playSymbolWin(e.isHighSymbol))}),Di.on("bonusEnter",async e=>{console.log("üé∞ Bonus triggered - transitioning to bonus scene"),await(this.sceneManager?.transitionTo("bonus"))}),Di.on("bonusExit",async()=>{console.log("üé∞ Bonus ended - returning to gameplay scene"),await(this.sceneManager?.transitionTo("gameplay"))}),this.setupKeyboardControls(),window.game=this,window.gameStore=Vi,console.log("üéÆ Game exposed to window.game for console testing"),console.log("üìä GameStore exposed to window.gameStore"),console.log("‚å®Ô∏è  Keyboard controls:"),console.log("   - SPACE: Spin"),console.log("   - T: Toggle Turbo Mode"),console.log("   - A: Start Auto-Spin (10 rounds)"),console.log("   - S: Stop Auto-Spin"),console.log("   - +/-: Increase/Decrease Bet")}setupKeyboardControls(){window.addEventListener("keydown",e=>{if(["Space","KeyT","KeyA","KeyS","Equal","Minus"].includes(e.code)&&e.preventDefault(),!e.repeat)switch(e.code){case"Space":this.spin();break;case"KeyT":Vi.toggleTurbo(),console.log("üöÄ Turbo mode: "+(Vi.turboMode?"ON":"OFF"));break;case"KeyA":Vi.isAutoSpin||(Vi.startAutoSpin(10),console.log("üîÑ Auto-spin started (10 rounds)"),this.spin());break;case"KeyS":Vi.isAutoSpin&&(Vi.stopAutoSpin(),console.log("‚èπÔ∏è  Auto-spin stopped"));break;case"Equal":case"NumpadAdd":Vi.setBetAmount(Vi.betAmount+.5),console.log(`üí∞ Bet: $${Vi.betAmount} (${Vi.adjustedBetAmount} with multiplier)`);break;case"Minus":case"NumpadSubtract":Vi.setBetAmount(Math.max(.1,Vi.betAmount-.5)),console.log(`üí∞ Bet: $${Vi.betAmount} (${Vi.adjustedBetAmount} with multiplier)`)}}),console.log("‚å®Ô∏è  Keyboard controls initialized")}update(e){this.sceneManager&&this.sceneManager.update(e)}getReelSystem(){if(this.reelSystem)return this.reelSystem;const e=this.sceneManager?.getScene("gameplay");return e?(this.reelSystem=e.getReelSystem(),this.reelSystem):null}async spin(){if(this.canSpin()){console.log("üé∞ Starting spin...");try{if(Vi.setCanSpin(!1),Vi.setSpinning(!0),Vi.setState(Ii.states.SPINNING),Vi.resetWin(),await Di.emit({type:"spinStart"}),!Vi.placeBet())throw new Error("Insufficient balance");const e=this.getReelSystem();if(!e)throw new Error("ReelSystem not initialized");await e.prespinReels(),Oi.playSpinStart();const t={game:"konbini",version:"v11",mode:Vi.betMode,amount:Vi.adjustedBetAmount,currency:Vi.currency},n=await Ni.play(t),i=Ni.parseBoardState(n),s=function(e){const t=e.map(e=>e.filter(e=>"scatter"===e).length);if(2===t.reduce((e,t)=>e+t,0)){const e=t.map((e,t)=>e>0?t:-1).filter(e=>-1!==e);return{hasAnticipation:!0,reels:[0,1,2,3,4].filter(t=>!e.includes(t)),intensity:"high"}}return{hasAnticipation:!1,reels:[],intensity:"low"}}(i.symbols);if(Vi.setState(Ii.states.REVEALING),await e.revealReels(i,s,Vi.inFreeSpins),await Di.emit({type:"spinEnd"}),Vi.updateBalance(n.balance),await Di.emit({type:"balanceUpdate",balance:n.balance}),i.totalWin>0&&await this.handleWin(i),i.bonusTriggered&&await this.handleBonusTrigger(i),Vi.isAutoSpin&&(Vi.decrementAutoSpin(),Vi.autoSpinRemaining>0&&Vi.canAffordBet))return await zi(1e3),void(await this.spin());if(Vi.inFreeSpins&&(Vi.decrementFreeSpins(),Vi.freeSpinsRemaining>0))return await zi(1e3),void(await this.spin())}catch(e){console.error("‚ùå Spin failed:",e),await Di.emit({type:"error",message:String(e)})}finally{Vi.setSpinning(!1),Vi.setCanSpin(!0),Vi.setState(Ii.states.IDLE)}}else console.warn("‚ö†Ô∏è Cannot spin")}async handleWin(e){console.log(`üí∞ Win: ${e.totalWin}`),Vi.setState(Ii.states.CELEBRATING);e.totalWin/Vi.adjustedBetAmount>=50?Oi.startWinCount(!0):e.totalWin>1&&Oi.playTotalWin(e.totalWin),Vi.addWinnings(e.totalWin),await Di.emit({type:"winPresent",amount:e.totalWin,lines:e.wins});const t=this.getReelSystem();t&&(await t.animateBoardWins(e),t.clearWinLines(),t.tintWhiteAllSymbols())}async handleBonusTrigger(e){console.log("üé∞ Bonus triggered!");const t=this.sceneManager?.getScene("bonus");t&&t.setScatterCount(e.scatterCount),await Di.emit({type:"bonusEnter",scatterCount:e.scatterCount})}async transitionToGameplayScene(){console.log("üéÆ Transitioning from intro to gameplay..."),this.sceneManager&&await this.sceneManager.transitionTo("gameplay"),console.log("‚úÖ Gameplay scene ready - player can now spin")}canSpin(){return this.isInitialized&&Vi.canSpin&&!Vi.isSpinning&&Vi.canAffordBet}setupResizeHandler(){const e=()=>{if(!this.app||!this.stage)return void console.warn("‚ö†Ô∏è Resize handler called but app/stage not ready");const e=this.app.renderer.width,t=this.app.renderer.height,n=e/2,i=t/2,s=Math.min(e/bs,t/ys);this.currentResponsiveScale=s;const a=.68*s,o=1*Math.max(e/bs,t/ys);if(console.log("üìê Resizing game:"),console.log(`  Viewport: ${e}x${t}`),console.log("  Design: 1920x1080"),console.log(`  Responsive scale: ${s.toFixed(3)}`),console.log(`  Game scale: ${a.toFixed(3)} (base 0.68 √ó responsive)`),console.log(`  Background scale: ${o.toFixed(3)} (cover mode)`),this.backgroundLayer&&(this.backgroundLayer.x=n,this.backgroundLayer.y=i,this.backgroundLayer.scale.set(o),console.log(`  ‚úÖ BackgroundLayer: pos (${n.toFixed(1)}, ${i.toFixed(1)}), scale ${o.toFixed(3)}`)),this.persistentLayer&&(this.persistentLayer.x=n,this.persistentLayer.y=i,this.persistentLayer.scale.set(a),console.log(`  ‚úÖ PersistentLayer: pos (${n.toFixed(1)}, ${i.toFixed(1)}), scale ${a.toFixed(3)}`)),this.transientLayer&&(this.transientLayer.x=n,this.transientLayer.y=i,this.transientLayer.scale.set(a),console.log(`  ‚úÖ TransientLayer: pos (${n.toFixed(1)}, ${i.toFixed(1)}), scale ${a.toFixed(3)}`)),this.uiLayer){this.uiLayer.x=n;const e=30,i=50;this.uiLayer.y=t-e-i*a,this.uiLayer.scale.set(a),console.log(`  ‚úÖ UILayer: pos (${n.toFixed(1)}, ${this.uiLayer.y.toFixed(1)}), scale ${a.toFixed(3)} (30px from bottom)`)}this.reelSystem&&(this.reelSystem.x=0,this.reelSystem.y=0,this.reelSystem.scale.set(1))};console.log("üîß Setting up responsive resize handler..."),window.addEventListener("resize",e),e()}getResponsiveScale(){return this.currentResponsiveScale}destroy(){this.sceneManager&&(this.sceneManager.destroy(),this.sceneManager=null),this.gameUI&&(this.gameUI.destroy(),this.gameUI=null),this.app&&(this.app.destroy(!0),this.app=null),this.reelSystem&&(this.reelSystem.destroy(),this.reelSystem=null),this.spineManager&&(this.spineManager.destroy(),this.spineManager=null),this.backgroundLayer&&(this.backgroundLayer.destroy(),this.backgroundLayer=null),Oi.destroy(),Di.destroy(),this.isInitialized=!1}}const Ss=e=>e;function vs(e,{delay:t=0,duration:n=400,easing:i=Ss}={}){const s=+getComputedStyle(e).opacity;return{delay:t,duration:n,easing:i,css:e=>"opacity: "+e*s}}var ks=gi('<div class="loader svelte-ndf92o"><div class="background svelte-ndf92o"></div> <div class="loader-content svelte-ndf92o"><div class="game-title svelte-ndf92o"><img src="/assets/images/knb_loader.webp" alt="Kombini" class="svelte-ndf92o"/></div> <div class="percentage svelte-ndf92o"> </div></div></div>');function _s(e,t){gt(t,!0);let n=Vt(()=>"loading"===Vi.state),i=Vt(()=>Math.round(Vi.loadingProgress));var s,a,o,l=(s=document.createDocumentFragment(),a=document.createComment(""),o=rn(),s.append(a,o),fi(a,o),s),r=dn(l),h=e=>{var t=ks(),n=pn(un(t),2),s=pn(un(n),2),a=un(s);!function(e,t=[],n=[],i=[]){Ft(i,t,n,t=>{gn(8,()=>e(...t.map(si)),!0)})}(()=>function(e,t){var n=null==t?"":"object"==typeof t?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}(a,`${si(i)??""}%`)),function(e,t,n,i){var s,a,o,l=!!(4&e),r=t.inert,h=t.style.overflow;function c(){return mn(()=>s??(s=n()(t,i?.()??{},{direction:"both"})))}var u={is_global:l,in(){t.inert=r,Ai(t,"introstart"),a=Ri(t,c(),o,1,()=>{Ai(t,"introend"),a?.abort(),a=s=void 0,t.style.overflow=h})},out(e){t.inert=!0,Ai(t,"outrostart"),o=Ri(t,c(),a,0,()=>{Ai(t,"outroend"),e?.()})},stop:()=>{a?.abort(),o?.abort()}},d=Dn;if((d.transitions??(d.transitions=[])).push(u),Si){var p=l;if(!p){for(var m=d.parent;m&&0!==(m.f&it);)for(;(m=m.parent)&&0===(m.f&je););p=!m||0!==(m.f&nt)}p&&Sn(()=>{li(()=>u.in())})}}(3,t,()=>vs,()=>({duration:300})),bi(e,t)};!function(e,t,n=!1){var i=new _i(e);function s(e,t){i.ensure(e,t)}kn(()=>{var e=!1;t((t,n=!0)=>{e=!0,s(n,t)}),e||s(!1,null)},n?it:0)}(r,e=>{si(n)&&e(h)}),bi(e,l),bt()}var xs,Bs,Ms=gi('<!> <div class="canvas-wrap svelte-1n46o8q"></div>',1);xs=function(e,t){gt(t,!1);let n=Jt(),i=null;xi(()=>(console.log("üéÆ Mounting Kombini Game..."),(async()=>{try{i=new ws,await i.init(si(n)),console.log("‚úÖ Game mounted successfully")}catch(e){console.error("‚ùå Failed to mount game:",e)}})(),()=>{i&&(i.destroy(),i=null)})),Wi();var s=Ms(),a=dn(s);_s(a,{}),function(e={},t,n){Sn(()=>{var i,s;return vn(()=>{i=s,s=[],li(()=>{e!==n(...s)&&(t(e,...s),i&&Li(n(...i),e)&&t(null,...i))})}),()=>{St(()=>{s&&Li(n(...s),e)&&t(null,...s)})}})}(pn(a,2),e=>Qt(n,e),()=>si(n)),bi(e,s),bt()},Bs={target:document.getElementById("app")},function(e,{target:t,anchor:n,props:i={},events:s,context:a,intro:o=!0}){!function(){if(void 0===sn){sn=window,an=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;on=$e(t,"firstChild").get,ln=$e(t,"nextSibling").get,Ve(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),Ve(n)&&(n.__t=void 0)}}();var l=new Set,r=e=>{for(var n=0;n<e.length;n++){var i=e[n];if(!l.has(i)){l.add(i);var s=wi(i);t.addEventListener(i,mi,{passive:s});var a=vi.get(i);void 0===a?(document.addEventListener(i,mi,{passive:s}),vi.set(i,1)):vi.set(i,a+1)}}};r(Ee(ui)),di.add(r);var h=void 0,c=function(e){Tt.ensure();const t=gn(524352,e,!0);return(e={})=>new Promise(n=>{e.outro?Cn(t,()=>{Mn(t),n(void 0)}):(Mn(t),n(void 0))})}(()=>{var c=n??t.appendChild(rn());return function(e,t,n){new $t(e,t,n)}(c,{pending:()=>{}},t=>{a&&(gt({}),mt.c=a),s&&(i.$$events=s),Si=o,h=e(t,i)||{},Si=!0,a&&bt()}),()=>{for(var e of l){t.removeEventListener(e,mi);var i=vi.get(e);0===--i?(document.removeEventListener(e,mi),vi.delete(e)):vi.set(e,i)}di.delete(r),c!==n&&c.parentNode?.removeChild(c)}});ki.set(h,c)}(xs,Bs);
